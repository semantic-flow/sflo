<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/sflo/favicon.ico"/><title>2025 11 04 Shared Logging and Errorhandling</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="A dendron-based wiki for sflo"/><meta property="og:title" content="2025 11 04 Shared Logging and Errorhandling"/><meta property="og:description" content="A dendron-based wiki for sflo"/><meta property="og:url" content="https://semantic-flow.github.io/sflo/notes/3hejrrsh4j7i5p2l7rk38n6/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="11/5/2025"/><meta property="article:modified_time" content="11/6/2025"/><link rel="canonical" href="https://semantic-flow.github.io/sflo/notes/3hejrrsh4j7i5p2l7rk38n6/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/sflo/_next/static/css/16a873435e51c1c5.css" as="style"/><link rel="stylesheet" href="/sflo/_next/static/css/16a873435e51c1c5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/sflo/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/sflo/_next/static/chunks/webpack-ab072f314bee576a.js" defer=""></script><script src="/sflo/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/sflo/_next/static/chunks/main-e7d9c70dd8957f37.js" defer=""></script><script src="/sflo/_next/static/chunks/pages/_app-a6232c6cf10e06f7.js" defer=""></script><script src="/sflo/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/sflo/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/sflo/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/sflo/_next/static/stable-build-id/_buildManifest.js" defer=""></script><script src="/sflo/_next/static/stable-build-id/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="2025-11-04-shared-logging-and-errorhandling">2025 11 04 Shared Logging and Errorhandling<a aria-hidden="true" class="anchor-heading icon-link" href="#2025-11-04-shared-logging-and-errorhandling"></a></h1>
<h2 id="prompt">Prompt<a aria-hidden="true" class="anchor-heading icon-link" href="#prompt"></a></h2>
<h1 id="semantic-flow-logging--error-handling-system-specification">Semantic Flow Logging &#x26; Error Handling System Specification<a aria-hidden="true" class="anchor-heading icon-link" href="#semantic-flow-logging--error-handling-system-specification"></a></h1>
<h2 id="nodejs-platform-rewrite">Node.js Platform Rewrite<a aria-hidden="true" class="anchor-heading icon-link" href="#nodejs-platform-rewrite"></a></h2>
<p><strong>Version:</strong> 1.0<br>
<strong>Date:</strong> November 4, 2025<br>
<strong>Status:</strong> Working Specification</p>
<hr>
<h2 id="overview">Overview<a aria-hidden="true" class="anchor-heading icon-link" href="#overview"></a></h2>
<p>This specification defines a streamlined, production-ready logging and error handling system for the Semantic Flow platform's Node.js rewrite. It consolidates the best features from the current Deno implementation while addressing identified redundancies and adding improvements for both CLI and service usage.</p>
<h3 id="design-goals">Design Goals<a aria-hidden="true" class="anchor-heading icon-link" href="#design-goals"></a></h3>
<ol>
<li><strong>Unified Architecture</strong>: Single system supporting both CLI tools and long-running services</li>
<li><strong>Simplified API</strong>: Eliminate redundant functions and streamline the interface  </li>
<li><strong>Enhanced Performance</strong>: Optimized for high-throughput service operations</li>
<li><strong>Better Developer Experience</strong>: Clear patterns, comprehensive documentation, and testing utilities</li>
<li><strong>Production Ready</strong>: Robust error recovery, monitoring, and observability features</li>
</ol>
<hr>
<h2 id="core-architecture">Core Architecture<a aria-hidden="true" class="anchor-heading icon-link" href="#core-architecture"></a></h2>
<h3 id="module-structure">Module Structure<a aria-hidden="true" class="anchor-heading icon-link" href="#module-structure"></a></h3>
<pre><code>src/logging/
├── core/
│   ├── logger.ts              # Main logger implementation
│   ├── types.ts               # Type definitions and interfaces
│   ├── formatters.ts          # Message formatting utilities
│   └── context.ts             # Context management and merging
├── channels/
│   ├── console.ts             # Console output channel
│   ├── file.ts                # File logging with rotation
│   └── monitoring.ts          # External monitoring (Sentry, etc.)
├── errors/
│   ├── capture.ts             # Error capture and logging
│   ├── recovery.ts            # Error recovery strategies  
│   ├── types.ts               # Error type definitions
│   └── factory.ts             # Error class factory utilities
├── config/
│   ├── loader.ts              # Configuration loading and validation
│   ├── schema.ts              # Configuration schema definitions
│   └── defaults.ts            # Default configurations
├── utils/
│   ├── context.ts             # AsyncLocalStorage context management
│   ├── performance.ts         # Performance monitoring utilities
│   ├── testing.ts             # Testing utilities and mocks
│   └── validation.ts          # Input validation helpers
└── index.ts                   # Main exports
</code></pre>
<hr>
<h2 id="type-system">Type System<a aria-hidden="true" class="anchor-heading icon-link" href="#type-system"></a></h2>
<h3 id="core-types">Core Types<a aria-hidden="true" class="anchor-heading icon-link" href="#core-types"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Enhanced log levels with numeric values for easy comparison</span>
<span class="token keyword module">export</span> <span class="token keyword">enum</span> <span class="token maybe-class-name">LogLevel</span> <span class="token punctuation">{</span>
  <span class="token constant">TRACE</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token constant">DEBUG</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token constant">INFO</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token constant">WARN</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR</span> <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">,</span>
  <span class="token constant">FATAL</span> <span class="token operator">=</span> <span class="token number">50</span>
<span class="token punctuation">}</span>

<span class="token comment">// String literals for configuration mapping</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">LogLevelStrings</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'trace'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'fatal'</span><span class="token punctuation">]</span> <span class="token keyword module">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">LogLevelString</span></span> <span class="token operator">=</span> <span class="token keyword">typeof</span> <span class="token maybe-class-name">LogLevelStrings</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Core log entry structure used throughout the system</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">LogEntry</span></span> <span class="token punctuation">{</span>
  timestamp<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>                 <span class="token comment">// Date.now()</span>
  level<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">;</span>
  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    stack<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    code<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  service<span class="token operator">:</span> <span class="token punctuation">{</span> 
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> 
    version<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> 
    instanceId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  pid<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  hostname<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Comprehensive but streamlined log context</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">LogContext</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// Core identification</span>
  operation<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  operationId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  component<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Semantic Flow specific context</span>
  meshId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  nodeId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  meshName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  nodeName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Performance tracking</span>
  startTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  duration<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  memoryUsage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Request context (for service mode)</span>
  requestId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  userId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  sessionId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Error context</span>
  errorCode<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  errorType<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  stackTrace<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  errorCause<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Flexible metadata</span>
  tags<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
  metadata<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Error capture options (for logging/reporting)</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">ErrorCaptureOptions</span></span> <span class="token punctuation">{</span>
  message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">;</span>
  logLevel<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  includeStackTrace<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  reportToMonitoring<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Error recovery options (for control flow)</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">ErrorRecoveryOptions</span><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  strategy<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span><span class="token punctuation">;</span>
  fallbackValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  retryCount<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  retryDelay<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  shouldRetry<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> attempt<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Base log channel interface for extensibility</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">LogChannel</span></span> <span class="token punctuation">{</span>
  <span class="token function">write</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> minLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Channel configuration</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">ChannelConfig</span></span> <span class="token punctuation">{</span>
  enabled<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  level<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  format<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token operator">|</span> <span class="token string">'pretty'</span> <span class="token operator">|</span> <span class="token string">'compact'</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Channel-specific options</span>
  <span class="token builtin">console</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    colors<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    timestamps<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  file<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    maxSize<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    maxFiles<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    rotationStrategy<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'time'</span> <span class="token operator">|</span> <span class="token string">'size'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  monitoring<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    provider<span class="token operator">:</span> <span class="token string">'sentry'</span> <span class="token operator">|</span> <span class="token string">'datadog'</span> <span class="token operator">|</span> <span class="token string">'newrelic'</span><span class="token punctuation">;</span>
    dsn<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    environment<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    sampleRate<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Main logger configuration</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">LoggerConfig</span></span> <span class="token punctuation">{</span>
  serviceName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  serviceVersion<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  environment<span class="token operator">:</span> <span class="token string">'development'</span> <span class="token operator">|</span> <span class="token string">'staging'</span> <span class="token operator">|</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
  instanceId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Channel configurations</span>
  <span class="token builtin">console</span><span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">;</span>
  file<span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">;</span>
  monitoring<span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Performance settings</span>
  async<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>        <span class="token comment">// true: buffered writes + sync stderr for ERROR/FATAL</span>
                        <span class="token comment">// false: synchronous writes where possible</span>
  bufferSize<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  flushInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Context settings</span>
  autoContext<span class="token operator">:</span> <span class="token punctuation">{</span>
    includeTimestamp<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    includeHostname<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    includeProcessInfo<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="error-types">Error Types<a aria-hidden="true" class="anchor-heading icon-link" href="#error-types"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Base error class with enhanced context</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token known-class-name class-name">SemanticFlowError</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> context<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> timestamp<span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> recoverable<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    context<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    recoverable <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">constructor</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">code</span> <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">timestamp</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">recoverable</span> <span class="token operator">=</span> recoverable<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Error factory to reduce boilerplate</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createErrorType</span><span class="token punctuation">(</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  recoverable <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">SemanticFlowError</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> <span class="token known-class-name class-name">SemanticFlowError</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> code<span class="token punctuation">,</span> context<span class="token punctuation">,</span> recoverable<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Specific error types using factory</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token known-class-name class-name">ValidationError</span> <span class="token operator">=</span> <span class="token function">createErrorType</span><span class="token punctuation">(</span><span class="token string">'ValidationError'</span><span class="token punctuation">,</span> <span class="token string">'VALIDATION_ERROR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token known-class-name class-name">ConfigurationError</span> <span class="token operator">=</span> <span class="token function">createErrorType</span><span class="token punctuation">(</span><span class="token string">'ConfigurationError'</span><span class="token punctuation">,</span> <span class="token string">'CONFIG_ERROR'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token known-class-name class-name">MeshProcessingError</span> <span class="token operator">=</span> <span class="token function">createErrorType</span><span class="token punctuation">(</span><span class="token string">'MeshProcessingError'</span><span class="token punctuation">,</span> <span class="token string">'MESH_PROCESSING_ERROR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token known-class-name class-name">ApiError</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token known-class-name class-name">SemanticFlowError</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> statusCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> statusCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token string">'API_ERROR'</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> statusCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="core-logger-interface">Core Logger Interface<a aria-hidden="true" class="anchor-heading icon-link" href="#core-logger-interface"></a></h2>
<h3 id="simplified-logger-api">Simplified Logger API<a aria-hidden="true" class="anchor-heading icon-link" href="#simplified-logger-api"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// Core logging methods (synchronous with async buffering)</span>
  <span class="token function">trace</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">info</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">fatal</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Context management (returns immutable context wrappers)</span>
  <span class="token function">withContext</span><span class="token punctuation">(</span>context<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
  <span class="token function">withOperation</span><span class="token punctuation">(</span>operation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> operationId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
  <span class="token function">withComponent</span><span class="token punctuation">(</span>component<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
  <span class="token function">child</span><span class="token punctuation">(</span>context<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span> <span class="token comment">// Alias for withContext</span>
  
  <span class="token comment">// Performance tracking</span>
  <span class="token function">startTimer</span><span class="token punctuation">(</span>operation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Timer</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Error capture (for logging/reporting only)</span>
  <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ErrorCaptureOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Lifecycle management</span>
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Child logger semantics documentation:</span>
<span class="token comment">// - child() returns a thin wrapper sharing transports and buffer with parent</span>
<span class="token comment">// - context is frozen and shallow-merged per call</span>
<span class="token comment">// - no mutation or context bleed between child instances</span>

<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Timer</span></span> <span class="token punctuation">{</span>
  <span class="token function">end</span><span class="token punctuation">(</span>context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">checkpoint</span><span class="token punctuation">(</span>label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="factory-functions">Factory Functions<a aria-hidden="true" class="anchor-heading icon-link" href="#factory-functions"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Singleton pattern with dependency injection support</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">initLogger</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LoggerConfig</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">__resetLoggerForTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">// Factory functions for initialization</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createLogger</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LoggerConfig</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createCliLogger</span><span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  verbose<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  quiet<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  format<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'pretty'</span> <span class="token operator">|</span> <span class="token string">'json'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createServiceLogger</span><span class="token punctuation">(</span>serviceName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  enableFileLogging<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  enableMonitoring<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  environment<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>

<span class="token comment">// Component-scoped logger (pure ESM)</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getComponentLogger</span><span class="token punctuation">(</span>sourceUrl<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">/* import.meta.url */</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>sourceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> base <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"unknown"</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> component <span class="token operator">=</span> base<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(m|c)?js|ts$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> component <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="separated-error-handling">Separated Error Handling<a aria-hidden="true" class="anchor-heading icon-link" href="#separated-error-handling"></a></h2>
<h3 id="error-capture-loggingreporting">Error Capture (Logging/Reporting)<a aria-hidden="true" class="anchor-heading icon-link" href="#error-capture-loggingreporting"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Pure error capture - only logs and reports, no control flow</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token maybe-class-name">ErrorCaptureOptions</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// Synchronous logging for ERROR/FATAL levels</span>
  <span class="token comment">// Async buffering for full reporting</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="error-recovery-control-flow">Error Recovery (Control Flow)<a aria-hidden="true" class="anchor-heading icon-link" href="#error-recovery-control-flow"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Error recovery strategies (simplified)</span>
<span class="token keyword module">export</span> <span class="token keyword">enum</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span> <span class="token punctuation">{</span>
  <span class="token constant">CONTINUE</span> <span class="token operator">=</span> <span class="token string">'continue'</span><span class="token punctuation">,</span>        <span class="token comment">// Don't throw, continue execution</span>
  <span class="token constant">RETHROW</span> <span class="token operator">=</span> <span class="token string">'rethrow'</span><span class="token punctuation">,</span>         <span class="token comment">// Log then rethrow (default)</span>
  <span class="token constant">FALLBACK</span> <span class="token operator">=</span> <span class="token string">'fallback'</span><span class="token punctuation">,</span>       <span class="token comment">// Return fallback value</span>
  <span class="token constant">RETRY</span> <span class="token operator">=</span> <span class="token string">'retry'</span>              <span class="token comment">// Retry operation with backoff</span>
<span class="token punctuation">}</span>

<span class="token comment">// Apply recovery strategy to an error</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">applyErrorRecovery</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryOptions</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token builtin">never</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// Implementation handles retry logic, fallbacks, etc.</span>
<span class="token punctuation">}</span>

<span class="token comment">// Convenience wrapper combining capture + recovery</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">withErrorHandling</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token function-variable function">operation</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    capture<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ErrorCaptureOptions</span><span class="token punctuation">;</span>
    recovery<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryOptions</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token property-access">capture</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token property-access">capture</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token property-access">recovery</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">applyErrorRecovery</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token property-access">recovery</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">throw</span> error<span class="token punctuation">;</span> <span class="token comment">// Default: rethrow</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="error-classification">Error Classification<a aria-hidden="true" class="anchor-heading icon-link" href="#error-classification"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ErrorClassifier</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">classify</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    severity<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
    recoverable<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    category<span class="token operator">:</span> <span class="token string">'system'</span> <span class="token operator">|</span> <span class="token string">'business'</span> <span class="token operator">|</span> <span class="token string">'validation'</span> <span class="token operator">|</span> <span class="token string">'network'</span> <span class="token operator">|</span> <span class="token string">'unknown'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">shouldReport</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> threshold<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token function">extractContext</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="channel-implementations">Channel Implementations<a aria-hidden="true" class="anchor-heading icon-link" href="#channel-implementations"></a></h2>
<h3 id="console-channel">Console Channel<a aria-hidden="true" class="anchor-heading icon-link" href="#console-channel"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ConsoleChannel</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">LogChannel</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> minLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> config<span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span> <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">write</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Guard against entries below minimum level</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">level</span> <span class="token operator">&#x3C;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Always synchronous for console - push async work to buffer</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">level</span> <span class="token operator">>=</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">writeSynchronous</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">writeStandard</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment">// Console doesn't buffer, so flush is a no-op</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Synchronous critical path for errors</span>
  <span class="token keyword">private</span> <span class="token function">writeSynchronous</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">formatCritical</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token property-access">stderr</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
      <span class="token comment">// Best effort - never throw from logging</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Standard output for non-critical levels</span>
  <span class="token keyword">private</span> <span class="token function">writeStandard</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> line <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">stdout</span><span class="token punctuation">.</span><span class="token property-access">isTTY</span> 
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">formatForTTY</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> 
      <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">formatForPipe</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token property-access">stdout</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
      <span class="token comment">// Best effort - never throw from logging</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Smart formatting based on environment</span>
  <span class="token keyword">private</span> <span class="token function">formatForTTY</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">formatForPipe</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">formatCritical</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="file-channel">File Channel<a aria-hidden="true" class="anchor-heading icon-link" href="#file-channel"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">FileChannel</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">LogChannel</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> minLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> buffer<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> flushTimer<span class="token operator">:</span> <span class="token maybe-class-name">NodeJS</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Timer</span></span> <span class="token operator">|</span> <span class="token keyword null nil">null</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> config<span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span> <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">write</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Guard against entries below minimum level</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">level</span> <span class="token operator">&#x3C;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Always async for file channel - add to buffer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">buffer</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">scheduleFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Single-flight flush to prevent concurrent flushes</span>
  <span class="token keyword">private</span> inflight<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">??</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">flushImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">=</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">flushTimer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">flushTimer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">flushTimer</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">flushBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Enhanced rotation with compression and atomic operations</span>
  <span class="token keyword">private</span> <span class="token function">rotateIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Uses fs.rename for atomicity</span>
  <span class="token keyword">private</span> <span class="token function">compressOldLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">scheduleFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">flushImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Uses fs.writev for batched writes</span>
  
  <span class="token comment">// File opened with O_APPEND for safe concurrent writes</span>
  <span class="token comment">// Reopen file descriptor after rotation</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="monitoring-channel">Monitoring Channel<a aria-hidden="true" class="anchor-heading icon-link" href="#monitoring-channel"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">MonitoringChannel</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">LogChannel</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> minLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> buffer<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> rateLimiter<span class="token operator">:</span> <span class="token maybe-class-name">RateLimiter</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> config<span class="token operator">:</span> <span class="token maybe-class-name">ChannelConfig</span><span class="token punctuation">[</span><span class="token string">'monitoring'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span> <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">rateLimiter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">RateLimiter</span></span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">sampleRate</span> <span class="token operator">||</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">write</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Guard against entries below minimum level</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">level</span> <span class="token operator">&#x3C;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">minLevel</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Apply sampling and rate limiting</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">shouldSample</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Always async for monitoring - add to buffer with timeout protection</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">buffer</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">scheduleFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Single-flight flush to prevent concurrent monitoring flushes</span>
  <span class="token keyword">private</span> inflight<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">??</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">flushImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">inflight</span> <span class="token operator">=</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">flushWithTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Provider-specific implementations</span>
  <span class="token keyword">private</span> sentryAdapter<span class="token operator">:</span> <span class="token maybe-class-name">SentryAdapter</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> datadogAdapter<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">DatadogAdapter</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Smart sampling and rate limiting with timeout protection</span>
  <span class="token keyword">private</span> <span class="token function">shouldSample</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">scheduleFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">flushImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Bounds batch size and applies per-entry deadlines</span>
  
  <span class="token comment">// Drop counter for monitoring timeouts/failures</span>
  <span class="token keyword">private</span> droppedCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">getDroppedCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">droppedCount</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Missing primitive definitions</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">RateLimiter</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> rate<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">allow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&#x3C;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">rate</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">SentryAdapter</span></span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">DatadogAdapter</span></span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="configuration-system">Configuration System<a aria-hidden="true" class="anchor-heading icon-link" href="#configuration-system"></a></h2>
<h3 id="async-flag-semantics">Async Flag Semantics<a aria-hidden="true" class="anchor-heading icon-link" href="#async-flag-semantics"></a></h3>
<p>The <code>async</code> configuration flag controls write behavior:</p>
<ul>
<li><strong><code>async: true</code></strong> (default): Non-blocking buffered writes for all channels. ERROR/FATAL levels also emit synchronously to <code>process.stderr</code> for immediate visibility.</li>
<li><strong><code>async: false</code></strong>: Console and file channels use <code>writeSync</code> on ERROR/FATAL and best-effort synchronous writes for other levels. Monitoring channel remains buffered with best-effort flush. <strong>Warning</strong>: Synchronous I/O can impact performance significantly under load.</li>
</ul>
<h3 id="schema-based-configuration">Schema-Based Configuration<a aria-hidden="true" class="anchor-heading icon-link" href="#schema-based-configuration"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// JSON Schema for logger configuration</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">LoggerConfigSchema</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    serviceName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> minLength<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    serviceVersion<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    environment<span class="token operator">:</span> <span class="token punctuation">{</span> 
      type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> 
      <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token string">'staging'</span><span class="token punctuation">,</span> <span class="token string">'production'</span><span class="token punctuation">]</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token builtin">console</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
      properties<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span> <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        level<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'trace'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'fatal'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        format<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'pretty'</span><span class="token punctuation">,</span> <span class="token string">'compact'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
      properties<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span> <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        level<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'trace'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'fatal'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        format<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'pretty'</span><span class="token punctuation">,</span> <span class="token string">'compact'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        maxSize<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> minimum<span class="token operator">:</span> <span class="token number">1024</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        maxFiles<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> minimum<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        rotationStrategy<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">,</span> <span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    monitoring<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
      properties<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span> <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        level<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'trace'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'fatal'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        provider<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sentry'</span><span class="token punctuation">,</span> <span class="token string">'datadog'</span><span class="token punctuation">,</span> <span class="token string">'newrelic'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dsn<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        environment<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        sampleRate<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> minimum<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> maximum<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'serviceName'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Configuration loader with multiple sources</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ConfigLoader</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">load</span><span class="token punctuation">(</span>sources<span class="token operator">:</span> <span class="token punctuation">{</span>
    defaults<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LoggerConfig</span><span class="token operator">></span><span class="token punctuation">;</span>
    configFile<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    environment<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
    cliArgs<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">validate</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token spread operator">...</span>configs<span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LoggerConfig</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Map string level names to enum values</span>
  <span class="token keyword">static</span> <span class="token function">parseLogLevel</span><span class="token punctuation">(</span>level<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token maybe-class-name">LogLevelStrings</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>level <span class="token keyword module">as</span> <span class="token maybe-class-name">LogLevelString</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> index <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>index <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">LogLevel</span> <span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="environment-variable-mapping">Environment Variable Mapping<a aria-hidden="true" class="anchor-heading icon-link" href="#environment-variable-mapping"></a></h3>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Service identification</span>
<span class="token assign-left variable">SF_SERVICE_NAME</span><span class="token operator">=</span>semantic-flow-service
<span class="token assign-left variable">SF_SERVICE_VERSION</span><span class="token operator">=</span><span class="token number">2.0</span>.0
<span class="token assign-left variable">SF_ENVIRONMENT</span><span class="token operator">=</span>production

<span class="token comment"># Console logging</span>
<span class="token assign-left variable">SF_LOG_CONSOLE_ENABLED</span><span class="token operator">=</span>true
<span class="token assign-left variable">SF_LOG_CONSOLE_LEVEL</span><span class="token operator">=</span>info
<span class="token assign-left variable">SF_LOG_CONSOLE_FORMAT</span><span class="token operator">=</span>pretty

<span class="token comment"># File logging  </span>
<span class="token assign-left variable">SF_LOG_FILE_ENABLED</span><span class="token operator">=</span>true
<span class="token assign-left variable">SF_LOG_FILE_PATH</span><span class="token operator">=</span>./logs/sf-service.log
<span class="token assign-left variable">SF_LOG_FILE_LEVEL</span><span class="token operator">=</span>debug
<span class="token assign-left variable">SF_LOG_FILE_MAX_SIZE</span><span class="token operator">=</span><span class="token number">10485760</span>
<span class="token assign-left variable">SF_LOG_FILE_MAX_FILES</span><span class="token operator">=</span><span class="token number">5</span>

<span class="token comment"># Monitoring</span>
<span class="token assign-left variable">SF_LOG_MONITORING_ENABLED</span><span class="token operator">=</span>true
<span class="token assign-left variable">SF_LOG_MONITORING_PROVIDER</span><span class="token operator">=</span>sentry
<span class="token assign-left variable">SF_LOG_MONITORING_DSN</span><span class="token operator">=</span>https://<span class="token punctuation">..</span>.
<span class="token assign-left variable">SF_LOG_MONITORING_SAMPLE_RATE</span><span class="token operator">=</span><span class="token number">0.1</span>
</code></pre>
<hr>
<h2 id="context-management">Context Management<a aria-hidden="true" class="anchor-heading icon-link" href="#context-management"></a></h2>
<h3 id="asynclocalstorage-integration">AsyncLocalStorage Integration<a aria-hidden="true" class="anchor-heading icon-link" href="#asynclocalstorage-integration"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Automatic context propagation using Node.js AsyncLocalStorage</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ContextManager</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> als <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">AsyncLocalStorage</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LogContext</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">run</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>context<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">,</span> <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">als</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">runAsync</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>context<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">,</span> <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">als</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">als</span><span class="token punctuation">.</span><span class="token method function property-access">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token function">merge</span><span class="token punctuation">(</span>context<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> current <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>current<span class="token punctuation">,</span> <span class="token spread operator">...</span>context <span class="token punctuation">}</span> <span class="token operator">:</span> context<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// HTTP middleware integration (framework-agnostic example)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> randomUUID <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'node:crypto'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createRequestLogger</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> method<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token function">get</span><span class="token punctuation">(</span>header<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  res<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> requestContext<span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    operation<span class="token operator">:</span> <span class="token string">'http-request'</span><span class="token punctuation">,</span>
    requestId<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">||</span> <span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    metadata<span class="token operator">:</span> <span class="token punctuation">{</span>
      method<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span>
      userAgent<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token maybe-class-name">ContextManager</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>requestContext<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>req <span class="token keyword module">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">logger</span> <span class="token operator">=</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> component<span class="token operator">:</span> <span class="token string">'http-handler'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="performance-enhancements">Performance Enhancements<a aria-hidden="true" class="anchor-heading icon-link" href="#performance-enhancements"></a></h2>
<h3 id="async-logging-with-buffering">Async Logging with Buffering<a aria-hidden="true" class="anchor-heading icon-link" href="#async-logging-with-buffering"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AsyncLogBuffer</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> buffer<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> flushTimer<span class="token operator">:</span> <span class="token maybe-class-name">NodeJS</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Timer</span></span> <span class="token operator">|</span> <span class="token keyword null nil">null</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> maxSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> flushInterval<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5000</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token function">add</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">autoFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="performance-monitoring">Performance Monitoring<a aria-hidden="true" class="anchor-heading icon-link" href="#performance-monitoring"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">PerformanceTracker</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">trackOperation</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    operation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
    logger<span class="token operator">:</span> <span class="token maybe-class-name">Logger</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">createTimer</span><span class="token punctuation">(</span>operation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> logger<span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Timer</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Memory usage tracking</span>
  <span class="token keyword">static</span> <span class="token function">trackMemory</span><span class="token punctuation">(</span>logger<span class="token operator">:</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Log volume metrics  </span>
  <span class="token keyword">static</span> <span class="token function">getLogMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    totalLogs<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    logsByLevel<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span>
    errorRate<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    avgResponseTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="testing-utilities">Testing Utilities<a aria-hidden="true" class="anchor-heading icon-link" href="#testing-utilities"></a></h2>
<h3 id="mock-logger">Mock Logger<a aria-hidden="true" class="anchor-heading icon-link" href="#mock-logger"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">MockLogger</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> logs<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> capturedErrors<span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ErrorCaptureOptions</span> <span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Implement all Logger methods with recording</span>
  <span class="token function">trace</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">info</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">fatal</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  
  <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ErrorCaptureOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">capturedErrors</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">,</span> options <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Also create a log entry for the error</span>
    <span class="token keyword">const</span> entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      timestamp<span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      level<span class="token operator">:</span> options<span class="token operator">?.</span>logLevel <span class="token operator">||</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> options<span class="token operator">?.</span>message <span class="token operator">||</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span> <span class="token operator">?</span> error<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> options<span class="token operator">?.</span>context<span class="token punctuation">,</span>
      error<span class="token operator">:</span> error <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span> <span class="token operator">?</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> error<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        message<span class="token operator">:</span> error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span>
        stack<span class="token operator">:</span> error<span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token operator">?.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token punctuation">(</span>error <span class="token keyword module">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">code</span>
      <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span>
      service<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'test-service'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pid<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">pid</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logs</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Test utilities</span>
  <span class="token function">findLogsByLevel</span><span class="token punctuation">(</span>level<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">findLogsByComponent</span><span class="token punctuation">(</span>component<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">findLogsByOperation</span><span class="token punctuation">(</span>operation<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">hasErrorWithCode</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">clearLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logs</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">capturedErrors</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">LoggerTestUtils</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">createMockLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">MockLogger</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token function">createTestConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token function">waitForLogs</span><span class="token punctuation">(</span>logger<span class="token operator">:</span> <span class="token maybe-class-name">MockLogger</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="integration-test-helpers">Integration Test Helpers<a aria-hidden="true" class="anchor-heading icon-link" href="#integration-test-helpers"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">LoggerIntegrationTests</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">testFileRotation</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TestResult</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">testErrorHandling</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TestResult</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PerformanceResult</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">testMonitoringIntegration</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token maybe-class-name">LoggerConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TestResult</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="usage-examples">Usage Examples<a aria-hidden="true" class="anchor-heading icon-link" href="#usage-examples"></a></h2>
<h3 id="cli-tool-usage">CLI Tool Usage<a aria-hidden="true" class="anchor-heading icon-link" href="#cli-tool-usage"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createCliLogger<span class="token punctuation">,</span> getComponentLogger <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@semantic-flow/logging'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createCliLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  verbose<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">argv</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'--verbose'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  format<span class="token operator">:</span> <span class="token string">'pretty'</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Component-scoped logger using import.meta.url</span>
<span class="token keyword">const</span> componentLogger <span class="token operator">=</span> <span class="token function">getComponentLogger</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">processFiles</span><span class="token punctuation">(</span>files<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> componentLogger<span class="token punctuation">.</span><span class="token method function property-access">startTimer</span><span class="token punctuation">(</span><span class="token string">'process-files'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    componentLogger<span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> files</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> fileLogger <span class="token operator">=</span> componentLogger<span class="token punctuation">.</span><span class="token method function property-access">withContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
        operation<span class="token operator">:</span> <span class="token string">'process-file'</span><span class="token punctuation">,</span>
        metadata<span class="token operator">:</span> <span class="token punctuation">{</span> filename<span class="token operator">:</span> file <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword control-flow">await</span> <span class="token function">processFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileLogger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    timer<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">{</span> metadata<span class="token operator">:</span> <span class="token punctuation">{</span> filesProcessed<span class="token operator">:</span> files<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Failed to process files'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token punctuation">{</span> metadata<span class="token operator">:</span> <span class="token punctuation">{</span> files <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      reportToMonitoring<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="service-usage">Service Usage<a aria-hidden="true" class="anchor-heading icon-link" href="#service-usage"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createServiceLogger<span class="token punctuation">,</span> getComponentLogger<span class="token punctuation">,</span> <span class="token maybe-class-name">ContextManager</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@semantic-flow/logging'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createServiceLogger</span><span class="token punctuation">(</span><span class="token string">'semantic-flow-api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enableFileLogging<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  enableMonitoring<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  environment<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Component-specific logger for this module</span>
<span class="token keyword">const</span> componentLogger <span class="token operator">=</span> <span class="token function">getComponentLogger</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> requestContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    operation<span class="token operator">:</span> <span class="token string">'api-request'</span><span class="token punctuation">,</span>
    requestId<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    metadata<span class="token operator">:</span> <span class="token punctuation">{</span>
      method<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span>
      userAgent<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token maybe-class-name">ContextManager</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>requestContext<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token property-access">logger</span> <span class="token operator">=</span> componentLogger<span class="token punctuation">.</span><span class="token method function property-access">child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> component<span class="token operator">:</span> <span class="token string">'http-handler'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="error-handling">Error Handling<a aria-hidden="true" class="anchor-heading icon-link" href="#error-handling"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> captureError<span class="token punctuation">,</span> withErrorHandling<span class="token punctuation">,</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@semantic-flow/logging'</span><span class="token punctuation">;</span>

<span class="token comment">// Simple error capture (logging only)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">riskyOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">doSomethingRisky</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Risky operation failed'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token punctuation">{</span> operation<span class="token operator">:</span> <span class="token string">'risky-op'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      includeStackTrace<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Continue with fallback logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Combined error handling with recovery</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">withErrorHandling</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">callExternalAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    capture<span class="token operator">:</span> <span class="token punctuation">{</span>
      context<span class="token operator">:</span> <span class="token punctuation">{</span> operation<span class="token operator">:</span> <span class="token string">'external-api-call'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      reportToMonitoring<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    recovery<span class="token operator">:</span> <span class="token punctuation">{</span>
      strategy<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span><span class="token punctuation">.</span><span class="token constant">RETRY</span><span class="token punctuation">,</span>
      retryCount<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      fallbackValue<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
      retryDelay<span class="token operator">:</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AsyncLocalStorage context propagation with ESM</span>
<span class="token keyword">const</span> componentLogger <span class="token operator">=</span> <span class="token function">getComponentLogger</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token maybe-class-name">ContextManager</span><span class="token punctuation">.</span><span class="token method function property-access">runAsync</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> operation<span class="token operator">:</span> <span class="token string">'batch-process'</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token string">'user123'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// All logging within this scope automatically includes the context</span>
    componentLogger<span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">'Starting batch process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Automatically includes operation + userId + component</span>
    
    <span class="token keyword control-flow">await</span> <span class="token function">processItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    componentLogger<span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">'Batch process completed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Dynamic import example for configuration loading</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> configModule <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> configModule<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Failed to load configuration module'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token punctuation">{</span> operation<span class="token operator">:</span> <span class="token string">'config-load'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="migration-guide">Migration Guide<a aria-hidden="true" class="anchor-heading icon-link" href="#migration-guide"></a></h2>
<h3 id="from-deno-implementation">From Deno Implementation<a aria-hidden="true" class="anchor-heading icon-link" href="#from-deno-implementation"></a></h3>
<ol>
<li><strong>Logger Initialization</strong>: Use <code>initLogger()</code> at startup, then <code>getLogger()</code> or <code>getComponentLogger(import.meta.url)</code> anywhere</li>
<li><strong>Error Handling</strong>: Replace both <code>handleError</code> and <code>handleCaughtError</code> with <code>captureError()</code> + optional recovery</li>
<li><strong>Configuration</strong>: Use schema-based config with singleton pattern</li>
<li><strong>Context Management</strong>: Use <code>AsyncLocalStorage</code> for automatic context propagation</li>
<li><strong>Async Methods</strong>: All logging methods are synchronous (with internal async buffering)</li>
<li><strong>Context Creation</strong>: Use immutable <code>child()</code> loggers instead of mutable context updates</li>
</ol>
<h3 id="breaking-changes">Breaking Changes<a aria-hidden="true" class="anchor-heading icon-link" href="#breaking-changes"></a></h3>
<ul>
<li>Log levels changed to enum with numeric values</li>
<li>Context merging behavior simplified</li>
<li>File rotation configuration consolidated</li>
<li>Sentry integration moved to generic monitoring channel</li>
</ul>
<hr>
<h2 id="implementation-plan">Implementation Plan<a aria-hidden="true" class="anchor-heading icon-link" href="#implementation-plan"></a></h2>
<h3 id="phase-1-core-infrastructure-week-1-2">Phase 1: Core Infrastructure (Week 1-2)<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-1-core-infrastructure-week-1-2"></a></h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> Type definitions and interfaces</li>
<li class="task-list-item"><input type="checkbox" disabled> Basic logger implementation</li>
<li class="task-list-item"><input type="checkbox" disabled> Console channel implementation</li>
<li class="task-list-item"><input type="checkbox" disabled> Configuration system</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests for core functionality</li>
</ul>
<h3 id="phase-2-advanced-features-week-3-4">Phase 2: Advanced Features (Week 3-4)<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-2-advanced-features-week-3-4"></a></h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> File channel with rotation</li>
<li class="task-list-item"><input type="checkbox" disabled> Monitoring channel (Sentry)</li>
<li class="task-list-item"><input type="checkbox" disabled> Unified error handling</li>
<li class="task-list-item"><input type="checkbox" disabled> Performance tracking</li>
<li class="task-list-item"><input type="checkbox" disabled> Integration tests</li>
</ul>
<h3 id="phase-3-cliservice-integration-week-5">Phase 3: CLI/Service Integration (Week 5)<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-3-cliservice-integration-week-5"></a></h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> CLI logger factory</li>
<li class="task-list-item"><input type="checkbox" disabled> Service logger factory  </li>
<li class="task-list-item"><input type="checkbox" disabled> Context management utilities</li>
<li class="task-list-item"><input type="checkbox" disabled> Documentation and examples</li>
</ul>
<h3 id="phase-4-testing--documentation-week-6">Phase 4: Testing &#x26; Documentation (Week 6)<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-4-testing--documentation-week-6"></a></h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> Comprehensive test suite</li>
<li class="task-list-item"><input type="checkbox" disabled> Performance benchmarks</li>
<li class="task-list-item"><input type="checkbox" disabled> Migration documentation</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation</li>
</ul>
<h4 id="detailed-test-plan">Detailed Test Plan<a aria-hidden="true" class="anchor-heading icon-link" href="#detailed-test-plan"></a></h4>
<p><strong>Core Functionality Tests:</strong></p>
<ul>
<li><strong>Deterministic clocks</strong>: Inject <code>now()</code> function into logger; use Vitest fake timers for predictable timestamps</li>
<li><strong>Rotation tests</strong>: Force size-based rotation with tiny <code>maxSize</code>; assert new file created and file descriptor reopened</li>
<li><strong>Signal tests</strong>: Simulate SIGINT/SIGTERM with child process; assert <code>flush()</code> called before exit</li>
<li><strong>No-throw contract</strong>: Intentionally throw inside a channel's <code>write</code> method; ensure logger falls back to console and does not crash caller</li>
<li><strong>ESM component detection</strong>: Test <code>getComponentLogger(import.meta.url)</code> with various file paths and extensions</li>
</ul>
<p><strong>Advanced Feature Tests:</strong></p>
<ul>
<li><strong>Monitoring timeouts</strong>: Stub adapter with delayed promise; assert drop counters increment when deadlines exceeded</li>
<li><strong>ALS propagation</strong>: Assert <code>ContextManager.current()</code> context merged into log entries across <code>await</code> points</li>
<li><strong>Recursive logging protection</strong>: Trigger error within logging code; verify fallback to console.error without infinite loops</li>
<li><strong>Back-pressure handling</strong>: Fill buffers beyond capacity; verify graceful degradation and dropped message counts</li>
<li><strong>Pure ESM integrity</strong>: Verify no <code>require()</code> calls in bundled output; test dynamic import usage</li>
</ul>
<hr>
<h2 id="success-criteria">Success Criteria<a aria-hidden="true" class="anchor-heading icon-link" href="#success-criteria"></a></h2>
<ol>
<li><strong>Performance</strong>: 50% faster than current Deno implementation</li>
<li><strong>Memory Usage</strong>: 30% lower memory footprint</li>
<li><strong>API Simplicity</strong>: 40% fewer public methods/functions</li>
<li><strong>Test Coverage</strong>: 95% code coverage</li>
<li><strong>Documentation</strong>: Complete API docs and usage examples</li>
<li><strong>Migration</strong>: Clear migration path from Deno version</li>
</ol>
<hr>
<h2 id="production-considerations">Production Considerations<a aria-hidden="true" class="anchor-heading icon-link" href="#production-considerations"></a></h2>
<h3 id="json-lines-output-format">JSON Lines Output Format<a aria-hidden="true" class="anchor-heading icon-link" href="#json-lines-output-format"></a></h3>
<p>All structured log output follows the JSON Lines format (newline-delimited JSON) for ingestion by log processors like FluentBit, Loki, or Elasticsearch:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Each log entry is a single JSON object terminated by \n</span>
<span class="token punctuation">{</span><span class="token string-property property">"timestamp"</span><span class="token operator">:</span><span class="token number">1699027200000</span><span class="token punctuation">,</span><span class="token string-property property">"level"</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string-property property">"message"</span><span class="token operator">:</span><span class="token string">"Server started"</span><span class="token punctuation">,</span><span class="token string-property property">"service"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"api"</span><span class="token punctuation">,</span><span class="token string-property property">"version"</span><span class="token operator">:</span><span class="token string">"1.0.0"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"pid"</span><span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string-property property">"timestamp"</span><span class="token operator">:</span><span class="token number">1699027201000</span><span class="token punctuation">,</span><span class="token string-property property">"level"</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string-property property">"message"</span><span class="token operator">:</span><span class="token string">"Database connection failed"</span><span class="token punctuation">,</span><span class="token string-property property">"error"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"Error"</span><span class="token punctuation">,</span><span class="token string-property property">"message"</span><span class="token operator">:</span><span class="token string">"Connection timeout"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"service"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"api"</span><span class="token punctuation">,</span><span class="token string-property property">"version"</span><span class="token operator">:</span><span class="token string">"1.0.0"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"pid"</span><span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">}</span>
</code></pre>
<h3 id="flush-guarantees">Flush Guarantees<a aria-hidden="true" class="anchor-heading icon-link" href="#flush-guarantees"></a></h3>
<p>The <code>flush()</code> method provides the following guarantees:</p>
<ul>
<li>Drains buffers of all enabled channels within a bounded time (default 5s timeout)</li>
<li>Never throws - errors are logged to console as fallback</li>
<li>Returns when all pending entries are written or timeout is reached</li>
<li>Safe to call multiple times concurrently</li>
</ul>
<h3 id="critical-path-reliability">Critical Path Reliability<a aria-hidden="true" class="anchor-heading icon-link" href="#critical-path-reliability"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Synchronous logging for ERROR/FATAL ensures immediate output</span>
<span class="token keyword">function</span> <span class="token function">logSyncCritical</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    t<span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">timestamp</span><span class="token punctuation">,</span>
    lvl<span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span>
    rid<span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">context</span><span class="token operator">?.</span>requestId
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span> 
    process<span class="token punctuation">.</span><span class="token property-access">stderr</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
    <span class="token comment">// Never throw from logging - best effort only</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Optional: Synchronous file write for critical errors</span>
  <span class="token comment">// if (criticalFd) fs.writeSync(criticalFd, line);</span>
<span class="token punctuation">}</span>

<span class="token comment">// Safe JSON serialization with limits and circular protection</span>
<span class="token keyword">const</span> <span class="token constant">MAX_CTX</span> <span class="token operator">=</span> <span class="token number">20_000</span><span class="token punctuation">,</span> <span class="token constant">MAX_MSG</span> <span class="token operator">=</span> <span class="token number">2_000</span><span class="token punctuation">,</span> <span class="token constant">MAX_STACK</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">safeStringify</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> maxLength <span class="token operator">=</span> <span class="token constant">MAX_CTX</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> seen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">WeakSet</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&#x26;&#x26;</span> val <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>seen<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token string">'[Circular]'</span><span class="token punctuation">;</span>
        seen<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&#x26;&#x26;</span> val<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token constant">MAX_MSG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> val<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">MAX_MSG</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...[truncated]'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> maxLength <span class="token operator">?</span> result<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> maxLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...[truncated]'</span> <span class="token operator">:</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'[Unserializable]'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Strip ANSI escape codes for non-TTY output</span>
<span class="token keyword">function</span> <span class="token function">stripAnsi</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> text<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\x1b\[[0-9;]*m</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// PII redaction hook (optional per channel)</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">RedactFn</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">RedactConfig</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token maybe-class-name">RedactFn</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">applyRedaction</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">,</span> redact<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">RedactConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redact<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> entry<span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token method function property-access">isArray</span><span class="token punctuation">(</span>redact<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Field-based redaction</span>
    <span class="token keyword">const</span> redactFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span>redact<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token arrow operator">=></span> 
      redactFields<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'[REDACTED]'</span> <span class="token operator">:</span> value
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Custom redaction function</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> redact<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ensure JSON lines contain no ANSI codes</span>
<span class="token keyword">function</span> <span class="token function">formatJsonLine</span><span class="token punctuation">(</span>entry<span class="token operator">:</span> <span class="token maybe-class-name">LogEntry</span><span class="token punctuation">,</span> redact<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">RedactConfig</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> redacted <span class="token operator">=</span> <span class="token function">applyRedaction</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> redact<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> serialized <span class="token operator">=</span> <span class="token function">safeStringify</span><span class="token punctuation">(</span>redacted<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token function">stripAnsi</span><span class="token punctuation">(</span>serialized<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="graceful-shutdown">Graceful Shutdown<a aria-hidden="true" class="anchor-heading icon-link" href="#graceful-shutdown"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token constant">SAFE_CLOSE_MS</span> <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>

<span class="token comment">// Comprehensive process termination hooks</span>
process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'beforeExit'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span> <span class="token function">gracefulExit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span> <span class="token function">gracefulExit</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Sync-log minimal line to stderr first</span>
  <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    t<span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lvl<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">FATAL</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token string">'Uncaught exception - process terminating'</span><span class="token punctuation">,</span>
    err<span class="token operator">:</span> error<span class="token punctuation">.</span><span class="token property-access">message</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span> process<span class="token punctuation">.</span><span class="token property-access">stderr</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token comment">// Then capture full error context</span>
  <span class="token function">captureError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    logLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">FATAL</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'Uncaught exception - process terminating'</span><span class="token punctuation">,</span>
    includeStackTrace<span class="token operator">:</span> <span class="token boolean">true</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">gracefulExit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'unhandledRejection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">captureError</span><span class="token punctuation">(</span>reason <span class="token keyword module">as</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    logLevel<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'Unhandled promise rejection'</span><span class="token punctuation">,</span>
    includeStackTrace<span class="token operator">:</span> <span class="token boolean">true</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">safeGetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Logger</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword nil">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gracefulExit</span><span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">safeGetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Race between proper close and timeout</span>
      <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        logger<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token arrow operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token constant">SAFE_CLOSE_MS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
    <span class="token comment">// Best effort - don't block exit</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">finally</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token method function property-access">exit</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="guard-against-recursive-logging">Guard Against Recursive Logging<a aria-hidden="true" class="anchor-heading icon-link" href="#guard-against-recursive-logging"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Use AsyncLocalStorage to prevent recursive logging per async context</span>
<span class="token keyword">const</span> recursionGuard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">AsyncLocalStorage</span><span class="token operator">&#x3C;</span><span class="token builtin">boolean</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">LoggerImpl</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token function">log</span><span class="token punctuation">(</span>level<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>recursionGuard<span class="token punctuation">.</span><span class="token method function property-access">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Prevent infinite loops in error handling - use direct console</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'Recursive logging detected:'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    recursionGuard<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">writeToChannels</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> message<span class="token punctuation">,</span> error<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">trace</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">TRACE</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">info</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">WARN</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> error<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">fatal</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token maybe-class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">FATAL</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> error<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">private</span> <span class="token function">writeToChannels</span><span class="token punctuation">(</span>level<span class="token operator">:</span> <span class="token maybe-class-name">LogLevel</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> error<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LogContext</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Implementation that might trigger errors and recursive logging</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="understanding-error-recovery-strategies">Understanding Error Recovery Strategies<a aria-hidden="true" class="anchor-heading icon-link" href="#understanding-error-recovery-strategies"></a></h2>
<p>Error recovery strategies control <strong>what happens after an error is logged</strong>, not the logging itself:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Example: Processing a batch of files</span>
<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">withErrorHandling</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">processFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      capture<span class="token operator">:</span> <span class="token punctuation">{</span> 
        message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to process </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        context<span class="token operator">:</span> <span class="token punctuation">{</span> operation<span class="token operator">:</span> <span class="token string">'file-processing'</span><span class="token punctuation">,</span> filename<span class="token operator">:</span> file <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      recovery<span class="token operator">:</span> <span class="token punctuation">{</span>
        strategy<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span><span class="token punctuation">.</span><span class="token constant">CONTINUE</span><span class="token punctuation">,</span> <span class="token comment">// Keep processing other files</span>
        <span class="token comment">// Don't let one bad file stop the whole batch</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Example: Critical database connection</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">withErrorHandling</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    capture<span class="token operator">:</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Database connection failed'</span><span class="token punctuation">,</span>
      reportToMonitoring<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    recovery<span class="token operator">:</span> <span class="token punctuation">{</span>
      strategy<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span><span class="token punctuation">.</span><span class="token constant">RETRY</span><span class="token punctuation">,</span>
      retryCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      retryDelay<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
      <span class="token comment">// Keep trying - app can't work without DB</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Example: Optional feature that might fail</span>
<span class="token keyword">const</span> userPreferences <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">withErrorHandling</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">loadUserPreferences</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    capture<span class="token operator">:</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Failed to load user preferences'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token punctuation">{</span> userId <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    recovery<span class="token operator">:</span> <span class="token punctuation">{</span>
      strategy<span class="token operator">:</span> <span class="token maybe-class-name">ErrorRecoveryStrategy</span><span class="token punctuation">.</span><span class="token constant">FALLBACK</span><span class="token punctuation">,</span>
      fallbackValue<span class="token operator">:</span> <span class="token constant">DEFAULT_PREFERENCES</span><span class="token punctuation">,</span>
      <span class="token comment">// App works fine with defaults</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<hr>
<h2 id="questions-for-review">Questions for Review<a aria-hidden="true" class="anchor-heading icon-link" href="#questions-for-review"></a></h2>
<ol>
<li>Should error recovery strategies be pluggable?</li>
</ol>
<hr>
<h2 id="future-enhancements-v2">Future Enhancements (v2+)<a aria-hidden="true" class="anchor-heading icon-link" href="#future-enhancements-v2"></a></h2>
<p>Items suggested in review but deferred for initial implementation:</p>
<ol>
<li><strong>Plugin Architecture</strong>: <code>logger.use(plugin)</code> for extensible middleware</li>
<li><strong>Circuit Breaker</strong>: Automatic monitoring channel fallback during outages  </li>
<li><strong>ErrorClassifier Registry</strong>: Pluggable error classification rules</li>
<li><strong>Advanced Performance Tracking</strong>: Built-in metrics collection and analysis</li>
<li><strong>Log Event Streaming</strong>: Global event emitter for real-time log processing</li>
<li><strong>Pluggable Formatters</strong>: Custom format registration system</li>
<li><strong>Advanced Context Features</strong>: Structured event fields, correlation IDs</li>
<li><strong>Log Compression</strong>: Automatic compression of rotated log files</li>
<li><strong>Source Location Capture</strong>: Optional <code>file</code>, <code>line</code>, <code>col</code> fields from stack traces in debug builds</li>
<li><strong>Custom Formatters</strong>: <code>registerFormatter(name, fn)</code> for pluggable output formats beyond json/pretty/compact</li>
</ol>
<p>These features can be added incrementally based on usage patterns and requirements.</p>
<h3 id="nice-to-have-before-v1">Nice-to-Have Before v1<a aria-hidden="true" class="anchor-heading icon-link" href="#nice-to-have-before-v1"></a></h3>
<ul>
<li><strong>Monitoring Timeouts</strong>: Per-entry deadlines and token-bucket rate limiting for monitoring channels</li>
<li><strong>Enhanced Error Context</strong>: Automatic source location capture in development mode</li>
<li><strong>Advanced Sampling</strong>: Intelligent sampling based on error patterns and frequency</li>
</ul>
<hr>
<h2 id="critical-review-summary">Critical Review Summary<a aria-hidden="true" class="anchor-heading icon-link" href="#critical-review-summary"></a></h2>
<p><strong>ChatGPT's feedback addressed key architectural issues:</strong></p>
<p>✅ <strong>Fixed</strong>: Async/sync API inconsistency<br>
✅ <strong>Fixed</strong>: Split error handling into capture + recovery concerns<br>
✅ <strong>Fixed</strong>: Added LogChannel interface for extensibility<br>
✅ <strong>Fixed</strong>: Added synchronous critical path for ERROR/FATAL<br>
✅ <strong>Fixed</strong>: Added AsyncLocalStorage for context propagation<br>
✅ <strong>Fixed</strong>: Added singleton pattern with DI support<br>
✅ <strong>Added</strong>: Error class factory to reduce boilerplate<br>
✅ <strong>Added</strong>: Context immutability clarification<br>
✅ <strong>Added</strong>: Production reliability safeguards  </p>
<p>📋 <strong>Deferred</strong>: Plugin architecture, circuit breakers, advanced features</p>
<p>The specification now provides a solid foundation that can be extended incrementally.</p>
<hr>
<hr>
<h2 id="packaging-and-runtime-requirements">Packaging and Runtime Requirements<a aria-hidden="true" class="anchor-heading icon-link" href="#packaging-and-runtime-requirements"></a></h2>
<h3 id="nodejs-support">Node.js Support<a aria-hidden="true" class="anchor-heading icon-link" href="#nodejs-support"></a></h3>
<ul>
<li><strong>Minimum version</strong>: Node.js >=24 (requires <code>AsyncLocalStorage</code> and <code>fs.writev</code>)</li>
<li><strong>Module format</strong>: <strong>Pure ESM</strong> only. All published JS is ES Modules. No CommonJS build.</li>
<li><strong>Package metadata</strong>:
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"@semantic-flow/logging"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./dist/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"./dist/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./dist/index.d.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"."</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./dist/index.d.ts"</span><span class="token punctuation">,</span>
      <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/index.js"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"./package.json"</span><span class="token operator">:</span> <span class="token string">"./package.json"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"engines"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">">=18.17"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h3 id="typescript-configuration">TypeScript Configuration<a aria-hidden="true" class="anchor-heading icon-link" href="#typescript-configuration"></a></h3>
<ul>
<li><strong>Compile ESM-only types</strong>:
<pre class="language-json"><code class="language-json"><span class="token comment">// tsconfig.build.json</span>
<span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ES2022"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES2022"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"bundler"</span><span class="token punctuation">,</span>
    <span class="token property">"declaration"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"declarationMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"emitDeclarationOnly"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>
    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"inlineSources"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"verbatimModuleSyntax"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"exactOptionalPropertyTypes"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ES2022"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h3 id="runtime-esm-hygiene">Runtime ESM Hygiene<a aria-hidden="true" class="anchor-heading icon-link" href="#runtime-esm-hygiene"></a></h3>
<ul>
<li><strong>No <code>require()</code></strong>: Use <code>import</code>/<code>import()</code> everywhere</li>
<li><strong>Replace <code>__dirname/__filename</code></strong>:
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"node:url"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> dirname <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"node:path"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> __dirname <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><strong>JSON imports</strong>:
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">schema</span> <span class="token keyword module">from</span> <span class="token string">"./schema.json"</span> <span class="token keyword">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"json"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><strong>CLI entry point</strong>:
<pre class="language-javascript"><code class="language-javascript"><span class="token hashbang comment">#!/usr/bin/env node</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> run <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'../dist/cli.js'</span><span class="token punctuation">;</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<h3 id="consumer-requirements">Consumer Requirements<a aria-hidden="true" class="anchor-heading icon-link" href="#consumer-requirements"></a></h3>
<ul>
<li><strong>Pure ESM consumers</strong>: Standard <code>import</code> statements</li>
<li><strong>CommonJS consumers</strong>: Must use dynamic <code>import('@semantic-flow/logging')</code></li>
<li><strong>Tree-shaking</strong>: Channels kept in separate files for optimal bundling</li>
</ul>
<h3 id="testing-vitest">Testing (Vitest)<a aria-hidden="true" class="anchor-heading icon-link" href="#testing-vitest"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// vitest.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    environment<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
    isolate<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="cicd-requirements">CI/CD Requirements<a aria-hidden="true" class="anchor-heading icon-link" href="#cicd-requirements"></a></h3>
<ul>
<li><strong>JSON Lines validation</strong>: Lint commit examples to ensure valid JSONL with newline at end</li>
<li><strong>Console hygiene</strong>: Enforce no <code>console.log</code> in src except inside <code>ConsoleChannel</code> or emergency fallback</li>
<li><strong>ESM purity check</strong>: Block accidental CJS fields in package.json or <code>*.cjs</code> files in dist/</li>
<li><strong>Type checking</strong>: Ensure all examples compile without errors</li>
<li><strong>Performance benchmarks</strong>: Automated benchmarks comparing against previous versions</li>
</ul>
<h3 id="build-tool-configuration">Build Tool Configuration<a aria-hidden="true" class="anchor-heading icon-link" href="#build-tool-configuration"></a></h3>
<p><strong>TypeScript Compiler (tsc)</strong>:</p>
<pre class="language-bash"><code class="language-bash">tsc --project tsconfig.build.json
</code></pre>
<p><strong>tsup</strong>:</p>
<pre class="language-bash"><code class="language-bash">tsup src/index.ts --format esm --dts --sourcemap
</code></pre>
<p><strong>Rollup</strong>:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/index.ts'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'esm'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>esbuild</strong>:</p>
<pre class="language-javascript"><code class="language-javascript">esbuild <span class="token operator">--</span>bundle src<span class="token operator">/</span>index<span class="token punctuation">.</span><span class="token property-access">ts</span> <span class="token operator">--</span>format<span class="token operator">=</span>esm <span class="token operator">--</span>outfile<span class="token operator">=</span>dist<span class="token operator">/</span>index<span class="token punctuation">.</span><span class="token property-access">js</span> <span class="token operator">--</span>sourcemap
</code></pre>
<h3 id="optional-runtime-guardrails">Optional Runtime Guardrails<a aria-hidden="true" class="anchor-heading icon-link" href="#optional-runtime-guardrails"></a></h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Add once at package init to catch CJS usage</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">require</span> <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'This package is ESM-only. Use import().'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="todo">TODO<a aria-hidden="true" class="anchor-heading icon-link" href="#todo"></a></h2>
<h3 id="phase-1-core-infrastructure--complete">Phase 1: Core Infrastructure ✅ COMPLETE<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-1-core-infrastructure--complete"></a></h3>
<p>[x] Create the <code>@semantic-flow/logging</code> package structure (directories, <code>package.json</code>, <code>tsconfig.json</code>).
[x] Implement type definitions and interfaces in <code>shared/logging/src/core/types.ts</code>.
[x] Implement error types and factory in <code>shared/logging/src/errors/types.ts</code> and <code>shared/logging/src/errors/factory.ts</code>.
[x] Implement the <code>ConsoleChannel</code> and <code>LogChannel</code> interface.
[x] Implement the core <code>Logger</code> interface and basic <code>LoggerImpl</code>.
[x] Implement the configuration system.
[x] Implement main exports and factory functions.
[x] Implement unit tests for core functionality.
[x] Developer documentation created in <code>documentation/dev.logging-and-error-handling.md</code>.</p>
<h3 id="phase-1-enhancement-function-name-capture--complete">Phase 1 Enhancement: Function Name Capture ✅ COMPLETE<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-1-enhancement-function-name-capture--complete"></a></h3>
<p>[x] Implement automatic function/method name capture in log context.
[x] Add configuration option to enable/disable function name capture.
[x] Update developer documentation with function name capture feature.
[x] Add unit tests for function name capture.</p>
<p><strong>Implementation Details:</strong></p>
<ul>
<li>Added <code>function?: string</code> field to <a href="/sflo/shared/logging/src/core/types.ts:22"><code>LogContext</code></a> interface</li>
<li>Added <code>captureFunctionName: boolean</code> to <code>autoContext</code> configuration (default: <code>NODE_ENV !== 'production'</code>)</li>
<li>Implemented stack trace parsing in <a href="/sflo/shared/logging/src/utils/stack-trace.ts:1"><code>shared/logging/src/utils/stack-trace.ts</code></a></li>
<li>Integrated capture into <a href="/sflo/shared/logging/src/core/logger.ts:137"><code>LoggerImpl.log()</code></a> method</li>
<li>Updated <a href="/sflo/documentation/dev.logging-and-error-handling.md:1"><code>documentation/dev.logging-and-error-handling.md</code></a> with comprehensive documentation</li>
<li>Added environment variable <code>SF_LOG_AUTO_CONTEXT_CAPTURE_FUNCTION_NAME</code></li>
<li>All 11 unit tests passing in <a href="/sflo/shared/logging/src/__tests__/core.test.ts:1"><code>shared/logging/src/__tests__/core.test.ts</code></a></li>
</ul>
<p><strong>Performance Considerations:</strong></p>
<ul>
<li>Function name capture is environment-aware (disabled in production by default)</li>
<li>Uses stack trace parsing which has a measurable performance cost</li>
<li>Can be explicitly enabled/disabled via configuration</li>
<li>Skips correct number of stack frames to capture the actual calling function</li>
</ul>
<h3 id="phase-2-advanced-features-planned">Phase 2: Advanced Features (Planned)<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-2-advanced-features-planned"></a></h3>
<p>[ ] File channel with rotation
[ ] Monitoring channel (Sentry)
[ ] Unified error handling (capture + recovery)
[ ] Performance tracking enhancements
[ ] Integration tests</p>
<h2 id="decision">Decision<a aria-hidden="true" class="anchor-heading icon-link" href="#decision"></a></h2>
<ul>
<li>modern ESM only, targeting NodeJS >=24</li>
</ul>
<h2 id="summary">Summary<a aria-hidden="true" class="anchor-heading icon-link" href="#summary"></a></h2>
<p>Phase 1: Core Infrastructure for the Shared Logging and Error Handling System (<code>@semantic-flow/logging</code>) is complete, following the specification in <a href="/sflo/documentation/task.2025-11-04-shared-logging-and-errorhandling.md:1"><code>documentation/task.2025-11-04-shared-logging-and-errorhandling.md</code></a>.</p>
<h2 id="phase-1-accomplishments">Phase 1 Accomplishments<a aria-hidden="true" class="anchor-heading icon-link" href="#phase-1-accomplishments"></a></h2>
<ol>
<li><strong>Package Setup:</strong> Created the <code>shared/logging/</code> package structure, including <code>package.json</code> and <code>tsconfig.json</code> configured for Pure ESM and Node.js >=18.17.</li>
<li><strong>Core Types:</strong> Implemented all core types and interfaces in <a href="/sflo/shared/logging/src/core/types.ts:1"><code>shared/logging/src/core/types.ts</code></a>, including <code>LogLevel</code>, <code>LogEntry</code>, <code>LogContext</code>, <code>LogChannel</code>, and <code>LoggerConfig</code>.</li>
<li><strong>Error Handling:</strong> Implemented the base <a href="/sflo/shared/logging/src/errors/types.ts:4"><code>SemanticFlowError</code></a> class and the <code>createErrorType</code> factory function in <a href="/sflo/shared/logging/src/errors/types.ts:1"><code>shared/logging/src/errors/types.ts</code></a>.</li>
<li><strong>Configuration:</strong> Implemented the configuration schema, default values, and the <code>ConfigLoader</code> class with deep merging and log level parsing in <code>shared/logging/src/config/</code>.</li>
<li><strong>Console Channel:</strong> Implemented the synchronous <a href="/sflo/shared/logging/src/channels/console.ts:9"><code>ConsoleChannel</code></a> and necessary formatting utilities (<code>safeStringify</code>, <code>stripAnsi</code>, <code>formatCritical</code>) in <a href="/sflo/shared/logging/src/channels/console.ts:1"><code>shared/logging/src/channels/console.ts</code></a> and <a href="/sflo/shared/logging/src/core/formatters.ts:1"><code>shared/logging/src/core/formatters.ts</code></a>.</li>
<li><strong>Core Logger:</strong> Implemented the <a href="/sflo/shared/logging/src/core/logger.ts:23"><code>Logger</code></a> interface and <a href="/sflo/shared/logging/src/core/logger.ts:91"><code>LoggerImpl</code></a> class, including auto-context generation, channel dispatch, and basic timer functionality.</li>
<li><strong>Context Management:</strong> Implemented the <a href="/sflo/shared/logging/src/core/context.ts:12"><code>ContextManager</code></a> using <code>AsyncLocalStorage</code> for context propagation.</li>
<li><strong>Factory Functions:</strong> Implemented the singleton pattern (<code>initLogger</code>, <code>getLogger</code>) and specialized factory functions (<code>createCliLogger</code>, <code>createServiceLogger</code>) in <a href="/sflo/shared/logging/src/core/logger.ts:1"><code>shared/logging/src/core/logger.ts</code></a>.</li>
<li><strong>Exports:</strong> Consolidated all public exports in <a href="/sflo/shared/logging/src/index.ts:1"><code>shared/logging/src/index.ts</code></a>.</li>
<li><strong>Unit Tests:</strong> Implemented core unit tests in <a href="/sflo/shared/logging/src/__tests__/core.test.ts:1"><code>shared/logging/src/__tests__/core.test.ts</code></a> using a <code>MockLogger</code> utility, covering singleton behavior, context propagation, and error handling.</li>
</ol>
<h2 id="functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host">function/method name capture, addressed all CodeRabbit suggestions, and integrated the logging system into sflo-host<a aria-hidden="true" class="anchor-heading icon-link" href="#functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host"></a></h2>
<h3 id="1-function-name-capture-feature-">1. Function Name Capture Feature ✅<a aria-hidden="true" class="anchor-heading icon-link" href="#1-function-name-capture-feature-"></a></h3>
<ul>
<li>Added <a href="/sflo/shared/logging/src/core/types.ts:22"><code>function?: string</code></a> field to <code>LogContext</code></li>
<li>Implemented stack trace parsing in <a href="/sflo/shared/logging/src/utils/stack-trace.ts:1"><code>shared/logging/src/utils/stack-trace.ts</code></a></li>
<li>Integrated into <a href="/sflo/shared/logging/src/core/logger.ts:139"><code>LoggerImpl.log()</code></a> with environment-aware defaults</li>
<li>Comprehensive documentation in <a href="/sflo/documentation/dev.logging-and-error-handling.md:108"><code>documentation/dev.logging-and-error-handling.md</code></a></li>
</ul>
<h3 id="2-coderabbit-critical-fixes-">2. CodeRabbit Critical Fixes ✅<a aria-hidden="true" class="anchor-heading icon-link" href="#2-coderabbit-critical-fixes-"></a></h3>
<ol>
<li><strong>Channel Sharing</strong> - Fixed resource leak where child loggers created duplicate channels</li>
<li><strong>Async Logger Cleanup</strong> - Made <code>initLogger()</code> async to properly await channel closure</li>
<li><strong>Test Reset Cleanup</strong> - Made <code>__resetLoggerForTests()</code> async with proper channel cleanup</li>
<li><strong>CLI Tool Name Safety</strong> - Added try-catch for <code>fileURLToPath()</code> edge cases</li>
<li><strong>Test Config Isolation</strong> - Fixed <code>createTestConfig()</code> to return deep copy</li>
<li><strong>Race Condition Fix</strong> - Fixed <code>waitForLogs()</code> with proper timeout cleanup</li>
<li><strong>Redaction Logic Fix</strong> - Fixed critical bug using <code>JSON.stringify</code> replacer correctly</li>
<li><strong>DoS Protection</strong> - Added <code>MAX_CTX * 2</code> upper bound for log entries</li>
<li><strong>Schema Validation</strong> - Added minimum constraints for <code>bufferSize</code>/<code>flushInterval</code></li>
<li><strong>Comment Clarity</strong> - Fixed misleading async buffering comment</li>
<li><strong>Code Cleanup</strong> - Removed unused <code>logs</code> property from <code>MockLogger</code></li>
</ol>
<h3 id="3-sflo-host-integration-">3. SFLO Host Integration ✅<a aria-hidden="true" class="anchor-heading icon-link" href="#3-sflo-host-integration-"></a></h3>
<p><strong>Updated Files:</strong></p>
<ul>
<li><a href="/sflo/sflo-host/package.json:15"><code>sflo-host/package.json</code></a> - Added <code>@semantic-flow/logging</code> dependency</li>
<li><a href="/sflo/sflo-host/src/index.ts:1"><code>sflo-host/src/index.ts</code></a> - Integrated logging system:
<ul>
<li>Replaced Fastify's built-in logger with <code>@semantic-flow/logging</code></li>
<li>Added component-scoped logger using <code>getComponentLogger(import.meta.url)</code></li>
<li>Initialized logger at startup with environment-aware configuration</li>
<li>Added graceful shutdown handlers for SIGTERM/SIGINT</li>
<li>Replaced all <code>app.log</code> calls with structured logging using <code>metadata</code> field</li>
<li>Added proper error handling with <code>logger.fatal()</code></li>
</ul>
</li>
</ul>
<p><strong>Integration Features:</strong></p>
<ul>
<li>Environment-aware log levels (DEBUG in dev, INFO in prod)</li>
<li>Pretty formatting in development, JSON in production</li>
<li>Component name automatically captured as 'index'</li>
<li>Graceful shutdown with log flushing</li>
<li>Structured logging with metadata for all application events</li>
</ul>
<h3 id="test-results-">Test Results ✅<a aria-hidden="true" class="anchor-heading icon-link" href="#test-results-"></a></h3>
<p>All 11 unit tests passing in <a href="/sflo/shared/logging/src/__tests__/core.test.ts:1"><code>shared/logging/src/__tests__/core.test.ts</code></a></p>
<h3 id="typescript-compilation-">TypeScript Compilation ✅<a aria-hidden="true" class="anchor-heading icon-link" href="#typescript-compilation-"></a></h3>
<ul>
<li>Logging package builds successfully</li>
<li>SFLO Host compiles without errors</li>
<li>All workspace dependencies linked correctly</li>
</ul>
<p>The <code>@semantic-flow/logging</code> package is now production-ready and fully integrated into the SFLO Host application!</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#prompt" title="Prompt">Prompt</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#semantic-flow-logging--error-handling-system-specification" title="Semantic Flow Logging &amp; Error Handling System Specification">Semantic Flow Logging &amp; Error Handling System Specification</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#nodejs-platform-rewrite" title="Node.js Platform Rewrite">Node.js Platform Rewrite</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#overview" title="Overview">Overview</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#design-goals" title="Design Goals">Design Goals</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#core-architecture" title="Core Architecture">Core Architecture</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#module-structure" title="Module Structure">Module Structure</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#type-system" title="Type System">Type System</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#core-types" title="Core Types">Core Types</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#error-types" title="Error Types">Error Types</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#core-logger-interface" title="Core Logger Interface">Core Logger Interface</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#simplified-logger-api" title="Simplified Logger API">Simplified Logger API</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#factory-functions" title="Factory Functions">Factory Functions</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#separated-error-handling" title="Separated Error Handling">Separated Error Handling</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#error-capture-loggingreporting" title="Error Capture (Logging/Reporting)">Error Capture (Logging/Reporting)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#error-recovery-control-flow" title="Error Recovery (Control Flow)">Error Recovery (Control Flow)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#error-classification" title="Error Classification">Error Classification</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#channel-implementations" title="Channel Implementations">Channel Implementations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#console-channel" title="Console Channel">Console Channel</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#file-channel" title="File Channel">File Channel</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#monitoring-channel" title="Monitoring Channel">Monitoring Channel</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#configuration-system" title="Configuration System">Configuration System</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#async-flag-semantics" title="Async Flag Semantics">Async Flag Semantics</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#schema-based-configuration" title="Schema-Based Configuration">Schema-Based Configuration</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#environment-variable-mapping" title="Environment Variable Mapping">Environment Variable Mapping</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#context-management" title="Context Management">Context Management</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#asynclocalstorage-integration" title="AsyncLocalStorage Integration">AsyncLocalStorage Integration</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#performance-enhancements" title="Performance Enhancements">Performance Enhancements</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#async-logging-with-buffering" title="Async Logging with Buffering">Async Logging with Buffering</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#performance-monitoring" title="Performance Monitoring">Performance Monitoring</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#testing-utilities" title="Testing Utilities">Testing Utilities</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#mock-logger" title="Mock Logger">Mock Logger</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#integration-test-helpers" title="Integration Test Helpers">Integration Test Helpers</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#usage-examples" title="Usage Examples">Usage Examples</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cli-tool-usage" title="CLI Tool Usage">CLI Tool Usage</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#service-usage" title="Service Usage">Service Usage</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#error-handling" title="Error Handling">Error Handling</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#migration-guide" title="Migration Guide">Migration Guide</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#from-deno-implementation" title="From Deno Implementation">From Deno Implementation</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#breaking-changes" title="Breaking Changes">Breaking Changes</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#implementation-plan" title="Implementation Plan">Implementation Plan</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-1-core-infrastructure-week-1-2" title="Phase 1: Core Infrastructure (Week 1-2)">Phase 1: Core Infrastructure (Week 1-2)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-2-advanced-features-week-3-4" title="Phase 2: Advanced Features (Week 3-4)">Phase 2: Advanced Features (Week 3-4)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-3-cliservice-integration-week-5" title="Phase 3: CLI/Service Integration (Week 5)">Phase 3: CLI/Service Integration (Week 5)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-4-testing--documentation-week-6" title="Phase 4: Testing &amp; Documentation (Week 6)">Phase 4: Testing &amp; Documentation (Week 6)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#detailed-test-plan" title="Detailed Test Plan">Detailed Test Plan</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#success-criteria" title="Success Criteria">Success Criteria</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#production-considerations" title="Production Considerations">Production Considerations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#json-lines-output-format" title="JSON Lines Output Format">JSON Lines Output Format</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#flush-guarantees" title="Flush Guarantees">Flush Guarantees</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#critical-path-reliability" title="Critical Path Reliability">Critical Path Reliability</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#graceful-shutdown" title="Graceful Shutdown">Graceful Shutdown</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#guard-against-recursive-logging" title="Guard Against Recursive Logging">Guard Against Recursive Logging</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#understanding-error-recovery-strategies" title="Understanding Error Recovery Strategies">Understanding Error Recovery Strategies</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#questions-for-review" title="Questions for Review">Questions for Review</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#future-enhancements-v2" title="Future Enhancements (v2+)">Future Enhancements (v2+)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#nice-to-have-before-v1" title="Nice-to-Have Before v1">Nice-to-Have Before v1</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#critical-review-summary" title="Critical Review Summary">Critical Review Summary</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#packaging-and-runtime-requirements" title="Packaging and Runtime Requirements">Packaging and Runtime Requirements</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#nodejs-support" title="Node.js Support">Node.js Support</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#typescript-configuration" title="TypeScript Configuration">TypeScript Configuration</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#runtime-esm-hygiene" title="Runtime ESM Hygiene">Runtime ESM Hygiene</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#consumer-requirements" title="Consumer Requirements">Consumer Requirements</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#testing-vitest" title="Testing (Vitest)">Testing (Vitest)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cicd-requirements" title="CI/CD Requirements">CI/CD Requirements</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#build-tool-configuration" title="Build Tool Configuration">Build Tool Configuration</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#optional-runtime-guardrails" title="Optional Runtime Guardrails">Optional Runtime Guardrails</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#todo" title="TODO">TODO</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-1-core-infrastructure--complete" title="Phase 1: Core Infrastructure ✅ COMPLETE">Phase 1: Core Infrastructure ✅ COMPLETE</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-1-enhancement-function-name-capture--complete" title="Phase 1 Enhancement: Function Name Capture ✅ COMPLETE">Phase 1 Enhancement: Function Name Capture ✅ COMPLETE</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-2-advanced-features-planned" title="Phase 2: Advanced Features (Planned)">Phase 2: Advanced Features (Planned)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#decision" title="Decision">Decision</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#summary" title="Summary">Summary</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#phase-1-accomplishments" title="Phase 1 Accomplishments">Phase 1 Accomplishments</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host" title="function/method name capture, addressed all CodeRabbit suggestions, and integrated the logging system into sflo-host">function/method name capture, addressed all CodeRabbit suggestions, and integrated the logging system into sflo-host</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#1-function-name-capture-feature-" title="1. Function Name Capture Feature ✅">1. Function Name Capture Feature ✅</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#2-coderabbit-critical-fixes-" title="2. CodeRabbit Critical Fixes ✅">2. CodeRabbit Critical Fixes ✅</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#3-sflo-host-integration-" title="3. SFLO Host Integration ✅">3. SFLO Host Integration ✅</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#test-results-" title="Test Results ✅">Test Results ✅</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#typescript-compilation-" title="TypeScript Compilation ✅">TypeScript Compilation ✅</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"3hejrrsh4j7i5p2l7rk38n6","title":"2025 11 04 Shared Logging and Errorhandling","desc":"","updated":1762452057464,"created":1762325430077,"custom":{},"fname":"task.2025-11-04-shared-logging-and-errorhandling","type":"note","vault":{"fsPath":"documentation","selfContained":false,"name":"sflo"},"contentHash":"92e6e0edb3d8c0e3b9f101a09d0dd7c6","links":[],"anchors":{"prompt":{"type":"header","text":"Prompt","value":"prompt","line":8,"column":0,"depth":2},"semantic-flow-logging--error-handling-system-specification":{"type":"header","text":"Semantic Flow Logging \u0026 Error Handling System Specification","value":"semantic-flow-logging--error-handling-system-specification","line":9,"column":0,"depth":1},"nodejs-platform-rewrite":{"type":"header","text":"Node.js Platform Rewrite","value":"nodejs-platform-rewrite","line":10,"column":0,"depth":2},"overview":{"type":"header","text":"Overview","value":"overview","line":18,"column":0,"depth":2},"design-goals":{"type":"header","text":"Design Goals","value":"design-goals","line":22,"column":0,"depth":3},"core-architecture":{"type":"header","text":"Core Architecture","value":"core-architecture","line":32,"column":0,"depth":2},"module-structure":{"type":"header","text":"Module Structure","value":"module-structure","line":34,"column":0,"depth":3},"type-system":{"type":"header","text":"Type System","value":"type-system","line":65,"column":0,"depth":2},"core-types":{"type":"header","text":"Core Types","value":"core-types","line":67,"column":0,"depth":3},"error-types":{"type":"header","text":"Error Types","value":"error-types","line":217,"column":0,"depth":3},"core-logger-interface":{"type":"header","text":"Core Logger Interface","value":"core-logger-interface","line":273,"column":0,"depth":2},"simplified-logger-api":{"type":"header","text":"Simplified Logger API","value":"simplified-logger-api","line":275,"column":0,"depth":3},"factory-functions":{"type":"header","text":"Factory Functions","value":"factory-functions","line":315,"column":0,"depth":3},"separated-error-handling":{"type":"header","text":"Separated Error Handling","value":"separated-error-handling","line":347,"column":0,"depth":2},"error-capture-loggingreporting":{"type":"header","text":"Error Capture (Logging/Reporting)","value":"error-capture-loggingreporting","line":349,"column":0,"depth":3},"error-recovery-control-flow":{"type":"header","text":"Error Recovery (Control Flow)","value":"error-recovery-control-flow","line":359,"column":0,"depth":3},"error-classification":{"type":"header","text":"Error Classification","value":"error-classification","line":400,"column":0,"depth":3},"channel-implementations":{"type":"header","text":"Channel Implementations","value":"channel-implementations","line":418,"column":0,"depth":2},"console-channel":{"type":"header","text":"Console Channel","value":"console-channel","line":420,"column":0,"depth":3},"file-channel":{"type":"header","text":"File Channel","value":"file-channel","line":480,"column":0,"depth":3},"monitoring-channel":{"type":"header","text":"Monitoring Channel","value":"monitoring-channel","line":527,"column":0,"depth":3},"configuration-system":{"type":"header","text":"Configuration System","value":"configuration-system","line":594,"column":0,"depth":2},"async-flag-semantics":{"type":"header","text":"Async Flag Semantics","value":"async-flag-semantics","line":596,"column":0,"depth":3},"schema-based-configuration":{"type":"header","text":"Schema-Based Configuration","value":"schema-based-configuration","line":603,"column":0,"depth":3},"environment-variable-mapping":{"type":"header","text":"Environment Variable Mapping","value":"environment-variable-mapping","line":671,"column":0,"depth":3},"context-management":{"type":"header","text":"Context Management","value":"context-management","line":700,"column":0,"depth":2},"asynclocalstorage-integration":{"type":"header","text":"AsyncLocalStorage Integration","value":"asynclocalstorage-integration","line":702,"column":0,"depth":3},"performance-enhancements":{"type":"header","text":"Performance Enhancements","value":"performance-enhancements","line":754,"column":0,"depth":2},"async-logging-with-buffering":{"type":"header","text":"Async Logging with Buffering","value":"async-logging-with-buffering","line":756,"column":0,"depth":3},"performance-monitoring":{"type":"header","text":"Performance Monitoring","value":"performance-monitoring","line":774,"column":0,"depth":3},"testing-utilities":{"type":"header","text":"Testing Utilities","value":"testing-utilities","line":801,"column":0,"depth":2},"mock-logger":{"type":"header","text":"Mock Logger","value":"mock-logger","line":803,"column":0,"depth":3},"integration-test-helpers":{"type":"header","text":"Integration Test Helpers","value":"integration-test-helpers","line":856,"column":0,"depth":3},"usage-examples":{"type":"header","text":"Usage Examples","value":"usage-examples","line":869,"column":0,"depth":2},"cli-tool-usage":{"type":"header","text":"CLI Tool Usage","value":"cli-tool-usage","line":871,"column":0,"depth":3},"service-usage":{"type":"header","text":"Service Usage","value":"service-usage","line":911,"column":0,"depth":3},"error-handling":{"type":"header","text":"Error Handling","value":"error-handling","line":943,"column":0,"depth":3},"migration-guide":{"type":"header","text":"Migration Guide","value":"migration-guide","line":1011,"column":0,"depth":2},"from-deno-implementation":{"type":"header","text":"From Deno Implementation","value":"from-deno-implementation","line":1013,"column":0,"depth":3},"breaking-changes":{"type":"header","text":"Breaking Changes","value":"breaking-changes","line":1022,"column":0,"depth":3},"implementation-plan":{"type":"header","text":"Implementation Plan","value":"implementation-plan","line":1031,"column":0,"depth":2},"phase-1-core-infrastructure-week-1-2":{"type":"header","text":"Phase 1: Core Infrastructure (Week 1-2)","value":"phase-1-core-infrastructure-week-1-2","line":1033,"column":0,"depth":3},"phase-2-advanced-features-week-3-4":{"type":"header","text":"Phase 2: Advanced Features (Week 3-4)","value":"phase-2-advanced-features-week-3-4","line":1040,"column":0,"depth":3},"phase-3-cliservice-integration-week-5":{"type":"header","text":"Phase 3: CLI/Service Integration (Week 5)","value":"phase-3-cliservice-integration-week-5","line":1047,"column":0,"depth":3},"phase-4-testing--documentation-week-6":{"type":"header","text":"Phase 4: Testing \u0026 Documentation (Week 6)","value":"phase-4-testing--documentation-week-6","line":1053,"column":0,"depth":3},"detailed-test-plan":{"type":"header","text":"Detailed Test Plan","value":"detailed-test-plan","line":1059,"column":0,"depth":4},"success-criteria":{"type":"header","text":"Success Criteria","value":"success-criteria","line":1077,"column":0,"depth":2},"production-considerations":{"type":"header","text":"Production Considerations","value":"production-considerations","line":1088,"column":0,"depth":2},"json-lines-output-format":{"type":"header","text":"JSON Lines Output Format","value":"json-lines-output-format","line":1090,"column":0,"depth":3},"flush-guarantees":{"type":"header","text":"Flush Guarantees","value":"flush-guarantees","line":1100,"column":0,"depth":3},"critical-path-reliability":{"type":"header","text":"Critical Path Reliability","value":"critical-path-reliability","line":1108,"column":0,"depth":3},"graceful-shutdown":{"type":"header","text":"Graceful Shutdown","value":"graceful-shutdown","line":1184,"column":0,"depth":3},"guard-against-recursive-logging":{"type":"header","text":"Guard Against Recursive Logging","value":"guard-against-recursive-logging","line":1250,"column":0,"depth":3},"understanding-error-recovery-strategies":{"type":"header","text":"Understanding Error Recovery Strategies","value":"understanding-error-recovery-strategies","line":1301,"column":0,"depth":2},"questions-for-review":{"type":"header","text":"Questions for Review","value":"questions-for-review","line":1359,"column":0,"depth":2},"future-enhancements-v2":{"type":"header","text":"Future Enhancements (v2+)","value":"future-enhancements-v2","line":1365,"column":0,"depth":2},"nice-to-have-before-v1":{"type":"header","text":"Nice-to-Have Before v1","value":"nice-to-have-before-v1","line":1382,"column":0,"depth":3},"critical-review-summary":{"type":"header","text":"Critical Review Summary","value":"critical-review-summary","line":1390,"column":0,"depth":2},"packaging-and-runtime-requirements":{"type":"header","text":"Packaging and Runtime Requirements","value":"packaging-and-runtime-requirements","line":1412,"column":0,"depth":2},"nodejs-support":{"type":"header","text":"Node.js Support","value":"nodejs-support","line":1414,"column":0,"depth":3},"typescript-configuration":{"type":"header","text":"TypeScript Configuration","value":"typescript-configuration","line":1437,"column":0,"depth":3},"runtime-esm-hygiene":{"type":"header","text":"Runtime ESM Hygiene","value":"runtime-esm-hygiene","line":1460,"column":0,"depth":3},"consumer-requirements":{"type":"header","text":"Consumer Requirements","value":"consumer-requirements","line":1480,"column":0,"depth":3},"testing-vitest":{"type":"header","text":"Testing (Vitest)","value":"testing-vitest","line":1485,"column":0,"depth":3},"cicd-requirements":{"type":"header","text":"CI/CD Requirements","value":"cicd-requirements","line":1497,"column":0,"depth":3},"build-tool-configuration":{"type":"header","text":"Build Tool Configuration","value":"build-tool-configuration","line":1504,"column":0,"depth":3},"optional-runtime-guardrails":{"type":"header","text":"Optional Runtime Guardrails","value":"optional-runtime-guardrails","line":1533,"column":0,"depth":3},"todo":{"type":"header","text":"TODO","value":"todo","line":1541,"column":0,"depth":2},"phase-1-core-infrastructure--complete":{"type":"header","text":"Phase 1: Core Infrastructure ✅ COMPLETE","value":"phase-1-core-infrastructure--complete","line":1543,"column":0,"depth":3},"phase-1-enhancement-function-name-capture--complete":{"type":"header","text":"Phase 1 Enhancement: Function Name Capture ✅ COMPLETE","value":"phase-1-enhancement-function-name-capture--complete","line":1554,"column":0,"depth":3},"phase-2-advanced-features-planned":{"type":"header","text":"Phase 2: Advanced Features (Planned)","value":"phase-2-advanced-features-planned","line":1575,"column":0,"depth":3},"decision":{"type":"header","text":"Decision","value":"decision","line":1583,"column":0,"depth":2},"summary":{"type":"header","text":"Summary","value":"summary","line":1588,"column":0,"depth":2},"phase-1-accomplishments":{"type":"header","text":"Phase 1 Accomplishments","value":"phase-1-accomplishments","line":1592,"column":0,"depth":2},"functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host":{"type":"header","text":"function/method name capture, addressed all CodeRabbit suggestions, and integrated the logging system into sflo-host","value":"functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host","line":1605,"column":0,"depth":2},"1-function-name-capture-feature-":{"type":"header","text":"1. Function Name Capture Feature ✅","value":"1-function-name-capture-feature-","line":1607,"column":0,"depth":3},"2-coderabbit-critical-fixes-":{"type":"header","text":"2. CodeRabbit Critical Fixes ✅","value":"2-coderabbit-critical-fixes-","line":1613,"column":0,"depth":3},"3-sflo-host-integration-":{"type":"header","text":"3. SFLO Host Integration ✅","value":"3-sflo-host-integration-","line":1627,"column":0,"depth":3},"test-results-":{"type":"header","text":"Test Results ✅","value":"test-results-","line":1646,"column":0,"depth":3},"typescript-compilation-":{"type":"header","text":"TypeScript Compilation ✅","value":"typescript-compilation-","line":1649,"column":0,"depth":3}},"children":[],"parent":"tasks","data":{},"schema":{"schemaId":"task","moduleId":"task"}},"body":"\u003ch1 id=\"2025-11-04-shared-logging-and-errorhandling\"\u003e2025 11 04 Shared Logging and Errorhandling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#2025-11-04-shared-logging-and-errorhandling\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"prompt\"\u003ePrompt\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#prompt\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch1 id=\"semantic-flow-logging--error-handling-system-specification\"\u003eSemantic Flow Logging \u0026#x26; Error Handling System Specification\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#semantic-flow-logging--error-handling-system-specification\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"nodejs-platform-rewrite\"\u003eNode.js Platform Rewrite\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nodejs-platform-rewrite\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eVersion:\u003c/strong\u003e 1.0\u003cbr\u003e\n\u003cstrong\u003eDate:\u003c/strong\u003e November 4, 2025\u003cbr\u003e\n\u003cstrong\u003eStatus:\u003c/strong\u003e Working Specification\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"overview\"\u003eOverview\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#overview\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThis specification defines a streamlined, production-ready logging and error handling system for the Semantic Flow platform's Node.js rewrite. It consolidates the best features from the current Deno implementation while addressing identified redundancies and adding improvements for both CLI and service usage.\u003c/p\u003e\n\u003ch3 id=\"design-goals\"\u003eDesign Goals\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#design-goals\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eUnified Architecture\u003c/strong\u003e: Single system supporting both CLI tools and long-running services\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSimplified API\u003c/strong\u003e: Eliminate redundant functions and streamline the interface  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eEnhanced Performance\u003c/strong\u003e: Optimized for high-throughput service operations\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBetter Developer Experience\u003c/strong\u003e: Clear patterns, comprehensive documentation, and testing utilities\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProduction Ready\u003c/strong\u003e: Robust error recovery, monitoring, and observability features\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"core-architecture\"\u003eCore Architecture\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#core-architecture\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"module-structure\"\u003eModule Structure\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#module-structure\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003esrc/logging/\n├── core/\n│   ├── logger.ts              # Main logger implementation\n│   ├── types.ts               # Type definitions and interfaces\n│   ├── formatters.ts          # Message formatting utilities\n│   └── context.ts             # Context management and merging\n├── channels/\n│   ├── console.ts             # Console output channel\n│   ├── file.ts                # File logging with rotation\n│   └── monitoring.ts          # External monitoring (Sentry, etc.)\n├── errors/\n│   ├── capture.ts             # Error capture and logging\n│   ├── recovery.ts            # Error recovery strategies  \n│   ├── types.ts               # Error type definitions\n│   └── factory.ts             # Error class factory utilities\n├── config/\n│   ├── loader.ts              # Configuration loading and validation\n│   ├── schema.ts              # Configuration schema definitions\n│   └── defaults.ts            # Default configurations\n├── utils/\n│   ├── context.ts             # AsyncLocalStorage context management\n│   ├── performance.ts         # Performance monitoring utilities\n│   ├── testing.ts             # Testing utilities and mocks\n│   └── validation.ts          # Input validation helpers\n└── index.ts                   # Main exports\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"type-system\"\u003eType System\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#type-system\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"core-types\"\u003eCore Types\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#core-types\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Enhanced log levels with numeric values for easy comparison\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eTRACE\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eDEBUG\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eINFO\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eWARN\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e30\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eERROR\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e40\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eFATAL\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e50\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// String literals for configuration mapping\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevelStrings\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'trace'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'debug'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'info'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'warn'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'error'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fatal'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevelString\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevelStrings\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Core log entry structure used throughout the system\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  timestamp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e                 \u003cspan class=\"token comment\"\u003e// Date.now()\u003c/span\u003e\n  level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    stack\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    code\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  service\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n    name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \n    version\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \n    instanceId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  pid\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  hostname\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Comprehensive but streamlined log context\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Core identification\u003c/span\u003e\n  operation\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  operationId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  component\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Semantic Flow specific context\u003c/span\u003e\n  meshId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  nodeId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  meshName\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  nodeName\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Performance tracking\u003c/span\u003e\n  startTime\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  duration\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  memoryUsage\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Request context (for service mode)\u003c/span\u003e\n  requestId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  userId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  sessionId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Error context\u003c/span\u003e\n  errorCode\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  errorType\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  stackTrace\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  errorCause\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Flexible metadata\u003c/span\u003e\n  tags\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  metadata\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Error capture options (for logging/reporting)\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  message\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  logLevel\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  includeStackTrace\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  reportToMonitoring\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Error recovery options (for control flow)\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryOptions\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  strategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  fallbackValue\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  retryCount\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  retryDelay\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  shouldRetry\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e attempt\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Base log channel interface for extensibility\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e minLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Channel configuration\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enabled\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  format\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'json'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'pretty'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'compact'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Channel-specific options\u003c/span\u003e\n  \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    colors\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    timestamps\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  file\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    path\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    maxSize\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    maxFiles\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    rotationStrategy\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'time'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'size'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  monitoring\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    provider\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'sentry'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'datadog'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'newrelic'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    dsn\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    environment\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    sampleRate\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Main logger configuration\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  serviceName\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  serviceVersion\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  environment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'development'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'staging'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'production'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  instanceId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Channel configurations\u003c/span\u003e\n  \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  file\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  monitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Performance settings\u003c/span\u003e\n  async\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e        \u003cspan class=\"token comment\"\u003e// true: buffered writes + sync stderr for ERROR/FATAL\u003c/span\u003e\n                        \u003cspan class=\"token comment\"\u003e// false: synchronous writes where possible\u003c/span\u003e\n  bufferSize\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  flushInterval\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Context settings\u003c/span\u003e\n  autoContext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    includeTimestamp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    includeHostname\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    includeProcessInfo\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"error-types\"\u003eError Types\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#error-types\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Base error class with enhanced context\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eSemanticFlowError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e code\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e timestamp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e recoverable\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    code\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    recoverable \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ename\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e code\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003econtext\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etimestamp\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erecoverable\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e recoverable\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Error factory to reduce boilerplate\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateErrorType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  code\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  recoverable \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eSemanticFlowError\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eSemanticFlowError\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e code\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e recoverable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ename\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Specific error types using factory\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eValidationError\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateErrorType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ValidationError'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'VALIDATION_ERROR'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eConfigurationError\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateErrorType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ConfigurationError'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'CONFIG_ERROR'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMeshProcessingError\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateErrorType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'MeshProcessingError'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'MESH_PROCESSING_ERROR'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eApiError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eSemanticFlowError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e statusCode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e statusCode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'API_ERROR'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estatusCode\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e statusCode\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"core-logger-interface\"\u003eCore Logger Interface\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#core-logger-interface\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"simplified-logger-api\"\u003eSimplified Logger API\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#simplified-logger-api\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Core logging methods (synchronous with async buffering)\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003etrace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003edebug\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewarn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efatal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Context management (returns immutable context wrappers)\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewithContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewithOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoperation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e operationId\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewithComponent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecomponent\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003echild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Alias for withContext\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Performance tracking\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003estartTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoperation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Error capture (for logging/reporting only)\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Lifecycle management\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Child logger semantics documentation:\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// - child() returns a thin wrapper sharing transports and buffer with parent\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// - context is frozen and shallow-merged per call\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// - no mutation or context bleed between child instances\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eTimer\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003echeckpoint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elabel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"factory-functions\"\u003eFactory Functions\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#factory-functions\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Singleton pattern with dependency injection support\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003einitLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePartial\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e__resetLoggerForTests\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Factory functions for initialization\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePartial\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateCliLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoptions\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  verbose\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  quiet\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  format\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'pretty'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'json'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateServiceLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserviceName\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enableFileLogging\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  enableMonitoring\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  environment\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Component-scoped logger (pure ESM)\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003egetComponentLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esourceUrl\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token comment\"\u003e/* import.meta.url */\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e file \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token constant\"\u003eURL\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esourceUrl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e base \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e file\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epathname\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esplit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epop\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e??\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"unknown\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e component \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e base\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ereplace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token regex\"\u003e\u003cspan class=\"token regex-delimiter\"\u003e/\u003c/span\u003e\u003cspan class=\"token regex-source language-regex\"\u003e\\.(m|c)?js|ts$\u003c/span\u003e\u003cspan class=\"token regex-delimiter\"\u003e/\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003echild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e component \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"separated-error-handling\"\u003eSeparated Error Handling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#separated-error-handling\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"error-capture-loggingreporting\"\u003eError Capture (Logging/Reporting)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#error-capture-loggingreporting\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Pure error capture - only logs and reports, no control flow\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Synchronous logging for ERROR/FATAL levels\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Async buffering for full reporting\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"error-recovery-control-flow\"\u003eError Recovery (Control Flow)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#error-recovery-control-flow\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Error recovery strategies (simplified)\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eCONTINUE\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'continue'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e        \u003cspan class=\"token comment\"\u003e// Don't throw, continue execution\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eRETHROW\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'rethrow'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e         \u003cspan class=\"token comment\"\u003e// Log then rethrow (default)\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eFALLBACK\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fallback'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e       \u003cspan class=\"token comment\"\u003e// Return fallback value\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eRETRY\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'retry'\u003c/span\u003e              \u003cspan class=\"token comment\"\u003e// Retry operation with backoff\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Apply recovery strategy to an error\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eapplyErrorRecovery\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  error\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  options\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryOptions\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Implementation handles retry logic, fallbacks, etc.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Convenience wrapper combining capture + recovery\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003ewithErrorHandling\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eoperation\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  options\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    capture\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    recovery\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryOptions\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003eoperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecapture\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecapture\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erecovery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003eapplyErrorRecovery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erecovery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ethrow\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Default: rethrow\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"error-classification\"\u003eError Classification\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#error-classification\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eErrorClassifier\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eclassify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    severity\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    recoverable\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    category\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'system'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'business'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'validation'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'network'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'unknown'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eshouldReport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e threshold\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eextractContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"channel-implementations\"\u003eChannel Implementations\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#channel-implementations\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"console-channel\"\u003eConsole Channel\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#console-channel\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eConsoleChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e minLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e config\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'console'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e config\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Guard against entries below minimum level\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token comment\"\u003e// Always synchronous for console - push async work to buffer\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eERROR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewriteSynchronous\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewriteStandard\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Console doesn't buffer, so flush is a no-op\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Synchronous critical path for errors\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ewriteSynchronous\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e line \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eformatCritical\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eline\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Best effort - never throw from logging\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Standard output for non-critical levels\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ewriteStandard\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e line \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estdout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eisTTY\u003c/span\u003e \n      \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eformatForTTY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n      \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eformatForPipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estdout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eline\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Best effort - never throw from logging\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Smart formatting based on environment\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eformatForTTY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eformatForPipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eformatCritical\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"file-channel\"\u003eFile Channel\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#file-channel\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eFileChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e minLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e buffer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e flushTimer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNodeJS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eTimer\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e config\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'file'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e config\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Guard against entries below minimum level\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token comment\"\u003e// Always async for file channel - add to buffer\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003escheduleFlush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Single-flight flush to prevent concurrent flushes\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e inflight\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e??\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eflushImpl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword control-flow\"\u003efinally\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eflushTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003eclearTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eflushTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eflushTimer\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eflushBuffer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Enhanced rotation with compression and atomic operations\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003erotateIfNeeded\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Uses fs.rename for atomicity\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ecompressOldLogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003escheduleFlush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eflushImpl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Uses fs.writev for batched writes\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// File opened with O_APPEND for safe concurrent writes\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Reopen file descriptor after rotation\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"monitoring-channel\"\u003eMonitoring Channel\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#monitoring-channel\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eMonitoringChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogChannel\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e minLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e buffer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e rateLimiter\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRateLimiter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e config\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eChannelConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'monitoring'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e config\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erateLimiter\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eRateLimiter\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003esampleRate\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Guard against entries below minimum level\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eminLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token comment\"\u003e// Apply sampling and rate limiting\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eshouldSample\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token comment\"\u003e// Always async for monitoring - add to buffer with timeout protection\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003escheduleFlush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Single-flight flush to prevent concurrent monitoring flushes\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e inflight\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e??\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eflushImpl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword control-flow\"\u003efinally\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einflight\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eflushWithTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Provider-specific implementations\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e sentryAdapter\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eSentryAdapter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e datadogAdapter\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDatadogAdapter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Smart sampling and rate limiting with timeout protection\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eshouldSample\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003escheduleFlush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eflushImpl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Bounds batch size and applies per-entry deadlines\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Drop counter for monitoring timeouts/failures\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e droppedCount \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003egetDroppedCount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003edroppedCount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Missing primitive definitions\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eRateLimiter\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e rate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eallow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erandom\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eSentryAdapter\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eDatadogAdapter\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"configuration-system\"\u003eConfiguration System\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#configuration-system\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"async-flag-semantics\"\u003eAsync Flag Semantics\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#async-flag-semantics\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003easync\u003c/code\u003e configuration flag controls write behavior:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003easync: true\u003c/code\u003e\u003c/strong\u003e (default): Non-blocking buffered writes for all channels. ERROR/FATAL levels also emit synchronously to \u003ccode\u003eprocess.stderr\u003c/code\u003e for immediate visibility.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003easync: false\u003c/code\u003e\u003c/strong\u003e: Console and file channels use \u003ccode\u003ewriteSync\u003c/code\u003e on ERROR/FATAL and best-effort synchronous writes for other levels. Monitoring channel remains buffered with best-effort flush. \u003cstrong\u003eWarning\u003c/strong\u003e: Synchronous I/O can impact performance significantly under load.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"schema-based-configuration\"\u003eSchema-Based Configuration\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#schema-based-configuration\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// JSON Schema for logger configuration\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfigSchema\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'object'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  properties\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    serviceName\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e minLength\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    serviceVersion\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    environment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n      type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n      \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'development'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'staging'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'production'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'object'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      properties\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        enabled\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'boolean'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'trace'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'debug'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'info'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'warn'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'error'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fatal'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        format\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'json'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'pretty'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'compact'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    file\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'object'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      properties\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        enabled\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'boolean'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'trace'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'debug'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'info'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'warn'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'error'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fatal'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        format\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'json'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'pretty'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'compact'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        maxSize\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'number'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e minimum\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1024\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        maxFiles\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'number'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e minimum\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        rotationStrategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'size'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    monitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'object'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      properties\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        enabled\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'boolean'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'trace'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'debug'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'info'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'warn'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'error'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fatal'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        provider\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sentry'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'datadog'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'newrelic'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        dsn\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        environment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        sampleRate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'number'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e minimum\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e maximum\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  required\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'serviceName'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Configuration loader with multiple sources\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eConfigLoader\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eload\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esources\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    defaults\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePartial\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    configFile\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    environment\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    cliArgs\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003evalidate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003emerge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003econfigs\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePartial\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Map string level names to enum values\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eparseLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e index \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevelStrings\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eindexOf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevelString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e index \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eindex \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eINFO\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"environment-variable-mapping\"\u003eEnvironment Variable Mapping\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#environment-variable-mapping\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# Service identification\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eSF_SERVICE_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003esemantic-flow-service\n\u003cspan class=\"token assign-left variable\"\u003eSF_SERVICE_VERSION\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e.0\n\u003cspan class=\"token assign-left variable\"\u003eSF_ENVIRONMENT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eproduction\n\n\u003cspan class=\"token comment\"\u003e# Console logging\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_CONSOLE_ENABLED\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etrue\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_CONSOLE_LEVEL\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003einfo\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_CONSOLE_FORMAT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003epretty\n\n\u003cspan class=\"token comment\"\u003e# File logging  \u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_FILE_ENABLED\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etrue\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_FILE_PATH\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e./logs/sf-service.log\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_FILE_LEVEL\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003edebug\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_FILE_MAX_SIZE\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e10485760\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_FILE_MAX_FILES\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Monitoring\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_MONITORING_ENABLED\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etrue\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_MONITORING_PROVIDER\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003esentry\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_MONITORING_DSN\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ehttps://\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n\u003cspan class=\"token assign-left variable\"\u003eSF_LOG_MONITORING_SAMPLE_RATE\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"context-management\"\u003eContext Management\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#context-management\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"asynclocalstorage-integration\"\u003eAsyncLocalStorage Integration\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#asynclocalstorage-integration\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Automatic context propagation using Node.js AsyncLocalStorage\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eContextManager\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e als \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eAsyncLocalStorage\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003erun\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003efn\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eals\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fn\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003erunAsync\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003efn\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eals\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fn\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eals\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003emerge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e current \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e current \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003ecurrent\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003econtext \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// HTTP middleware integration (framework-agnostic example)\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e randomUUID \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'node:crypto'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateRequestLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  req\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e method\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eheader\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  res\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003enext\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e requestContext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'http-request'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    requestId\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token function\"\u003erandomUUID\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    metadata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      method\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emethod\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      userAgent\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'User-Agent'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token maybe-class-name\"\u003eContextManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequestContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereq \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elogger\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003echild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e component\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'http-handler'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003enext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"performance-enhancements\"\u003ePerformance Enhancements\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#performance-enhancements\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"async-logging-with-buffering\"\u003eAsync Logging with Buffering\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#async-logging-with-buffering\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eAsyncLogBuffer\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e buffer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e flushTimer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNodeJS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eTimer\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e maxSize\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e flushInterval\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5000\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eautoFlush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"performance-monitoring\"\u003ePerformance Monitoring\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#performance-monitoring\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePerformanceTracker\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003etrackOperation\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003efn\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    logger\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoperation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e logger\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Memory usage tracking\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003etrackMemory\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elogger\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Log volume metrics  \u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogMetrics\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    totalLogs\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    logsByLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRecord\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    errorRate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    avgResponseTime\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"testing-utilities\"\u003eTesting Utilities\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#testing-utilities\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"mock-logger\"\u003eMock Logger\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#mock-logger\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eMockLogger\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e logs\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e capturedErrors\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eArray\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Implement all Logger methods with recording\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003etrace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003edebug\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ewarn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efatal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorCaptureOptions\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecapturedErrors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Also create a log entry for the error\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e entry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      timestamp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003enow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      level\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?.\u003c/span\u003elogLevel \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eERROR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?.\u003c/span\u003emessage \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror \u003cspan class=\"token keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e options\u003cspan class=\"token operator\"\u003e?.\u003c/span\u003econtext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      error\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e error \u003cspan class=\"token keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        stack\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estack\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esplit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        code\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecode\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      service\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'test-service'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      pid\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epid\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Test utilities\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efindLogsByLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efindLogsByComponent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecomponent\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efindLogsByOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoperation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ehasErrorWithCode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eclearLogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ecapturedErrors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerTestUtils\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateMockLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eMockLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateTestConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003ewaitForLogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elogger\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eMockLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e timeout\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"integration-test-helpers\"\u003eIntegration Test Helpers\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#integration-test-helpers\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerIntegrationTests\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token function\"\u003etestFileRotation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eTestResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token function\"\u003etestErrorHandling\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eTestResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token function\"\u003etestPerformance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003ePerformanceResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token function\"\u003etestMonitoringIntegration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLoggerConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eTestResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"usage-examples\"\u003eUsage Examples\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#usage-examples\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"cli-tool-usage\"\u003eCLI Tool Usage\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cli-tool-usage\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e createCliLogger\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e getComponentLogger \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'@semantic-flow/logging'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e logger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateCliLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n  verbose\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eargv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eincludes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--verbose'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  format\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'pretty'\u003c/span\u003e \n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Component-scoped logger using import.meta.url\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e componentLogger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetComponentLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emeta\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eprocessFiles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efiles\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e timer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estartTimer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'process-files'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eProcessing \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003efiles\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e files\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token keyword control-flow\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e file \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e files\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e fileLogger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewithContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n        operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'process-file'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        metadata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e filename\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e file \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \n      \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003eprocessFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efile\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fileLogger\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \n    timer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e metadata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e filesProcessed\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e files\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Failed to process files'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e metadata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e files \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      reportToMonitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ethrow\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"service-usage\"\u003eService Usage\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#service-usage\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e createServiceLogger\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e getComponentLogger\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eContextManager\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'@semantic-flow/logging'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e logger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateServiceLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'semantic-flow-api'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enableFileLogging\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  enableMonitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  environment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eNODE_ENV\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Component-specific logger for this module\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e componentLogger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetComponentLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emeta\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e next\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e requestContext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'api-request'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    requestId\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    metadata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      method\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emethod\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      userAgent\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'User-Agent'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token maybe-class-name\"\u003eContextManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequestContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elogger\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003echild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e component\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'http-handler'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003enext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"error-handling\"\u003eError Handling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#error-handling\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e captureError\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e withErrorHandling\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'@semantic-flow/logging'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Simple error capture (logging only)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eriskyOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003edoSomethingRisky\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Risky operation failed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'risky-op'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      includeStackTrace\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Continue with fallback logic\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Combined error handling with recovery\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithErrorHandling\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003ecallExternalAPI\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    capture\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'external-api-call'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      reportToMonitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    recovery\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      strategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eRETRY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      retryCount\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      fallbackValue\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      retryDelay\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// AsyncLocalStorage context propagation with ESM\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e componentLogger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetComponentLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emeta\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token maybe-class-name\"\u003eContextManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erunAsync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'batch-process'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e userId\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user123'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// All logging within this scope automatically includes the context\u003c/span\u003e\n    componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Starting batch process'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Automatically includes operation + userId + component\u003c/span\u003e\n    \n    \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003eprocessItems\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    componentLogger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Batch process completed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Dynamic import example for configuration loading\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eloadConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e configModule \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./config.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e configModule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Failed to load configuration module'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'config-load'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ethrow\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"migration-guide\"\u003eMigration Guide\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#migration-guide\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"from-deno-implementation\"\u003eFrom Deno Implementation\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#from-deno-implementation\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eLogger Initialization\u003c/strong\u003e: Use \u003ccode\u003einitLogger()\u003c/code\u003e at startup, then \u003ccode\u003egetLogger()\u003c/code\u003e or \u003ccode\u003egetComponentLogger(import.meta.url)\u003c/code\u003e anywhere\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eError Handling\u003c/strong\u003e: Replace both \u003ccode\u003ehandleError\u003c/code\u003e and \u003ccode\u003ehandleCaughtError\u003c/code\u003e with \u003ccode\u003ecaptureError()\u003c/code\u003e + optional recovery\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConfiguration\u003c/strong\u003e: Use schema-based config with singleton pattern\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContext Management\u003c/strong\u003e: Use \u003ccode\u003eAsyncLocalStorage\u003c/code\u003e for automatic context propagation\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAsync Methods\u003c/strong\u003e: All logging methods are synchronous (with internal async buffering)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContext Creation\u003c/strong\u003e: Use immutable \u003ccode\u003echild()\u003c/code\u003e loggers instead of mutable context updates\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"breaking-changes\"\u003eBreaking Changes\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#breaking-changes\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eLog levels changed to enum with numeric values\u003c/li\u003e\n\u003cli\u003eContext merging behavior simplified\u003c/li\u003e\n\u003cli\u003eFile rotation configuration consolidated\u003c/li\u003e\n\u003cli\u003eSentry integration moved to generic monitoring channel\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"implementation-plan\"\u003eImplementation Plan\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#implementation-plan\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"phase-1-core-infrastructure-week-1-2\"\u003ePhase 1: Core Infrastructure (Week 1-2)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-1-core-infrastructure-week-1-2\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul class=\"contains-task-list\"\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Type definitions and interfaces\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Basic logger implementation\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Console channel implementation\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Configuration system\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Unit tests for core functionality\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"phase-2-advanced-features-week-3-4\"\u003ePhase 2: Advanced Features (Week 3-4)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-2-advanced-features-week-3-4\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul class=\"contains-task-list\"\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e File channel with rotation\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Monitoring channel (Sentry)\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Unified error handling\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Performance tracking\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Integration tests\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"phase-3-cliservice-integration-week-5\"\u003ePhase 3: CLI/Service Integration (Week 5)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-3-cliservice-integration-week-5\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul class=\"contains-task-list\"\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e CLI logger factory\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Service logger factory  \u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Context management utilities\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Documentation and examples\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"phase-4-testing--documentation-week-6\"\u003ePhase 4: Testing \u0026#x26; Documentation (Week 6)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-4-testing--documentation-week-6\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul class=\"contains-task-list\"\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Comprehensive test suite\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Performance benchmarks\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Migration documentation\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e API documentation\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"detailed-test-plan\"\u003eDetailed Test Plan\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#detailed-test-plan\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eCore Functionality Tests:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eDeterministic clocks\u003c/strong\u003e: Inject \u003ccode\u003enow()\u003c/code\u003e function into logger; use Vitest fake timers for predictable timestamps\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRotation tests\u003c/strong\u003e: Force size-based rotation with tiny \u003ccode\u003emaxSize\u003c/code\u003e; assert new file created and file descriptor reopened\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSignal tests\u003c/strong\u003e: Simulate SIGINT/SIGTERM with child process; assert \u003ccode\u003eflush()\u003c/code\u003e called before exit\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNo-throw contract\u003c/strong\u003e: Intentionally throw inside a channel's \u003ccode\u003ewrite\u003c/code\u003e method; ensure logger falls back to console and does not crash caller\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eESM component detection\u003c/strong\u003e: Test \u003ccode\u003egetComponentLogger(import.meta.url)\u003c/code\u003e with various file paths and extensions\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eAdvanced Feature Tests:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMonitoring timeouts\u003c/strong\u003e: Stub adapter with delayed promise; assert drop counters increment when deadlines exceeded\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eALS propagation\u003c/strong\u003e: Assert \u003ccode\u003eContextManager.current()\u003c/code\u003e context merged into log entries across \u003ccode\u003eawait\u003c/code\u003e points\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRecursive logging protection\u003c/strong\u003e: Trigger error within logging code; verify fallback to console.error without infinite loops\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBack-pressure handling\u003c/strong\u003e: Fill buffers beyond capacity; verify graceful degradation and dropped message counts\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePure ESM integrity\u003c/strong\u003e: Verify no \u003ccode\u003erequire()\u003c/code\u003e calls in bundled output; test dynamic import usage\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"success-criteria\"\u003eSuccess Criteria\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#success-criteria\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003ePerformance\u003c/strong\u003e: 50% faster than current Deno implementation\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMemory Usage\u003c/strong\u003e: 30% lower memory footprint\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAPI Simplicity\u003c/strong\u003e: 40% fewer public methods/functions\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTest Coverage\u003c/strong\u003e: 95% code coverage\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDocumentation\u003c/strong\u003e: Complete API docs and usage examples\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMigration\u003c/strong\u003e: Clear migration path from Deno version\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"production-considerations\"\u003eProduction Considerations\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#production-considerations\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"json-lines-output-format\"\u003eJSON Lines Output Format\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#json-lines-output-format\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll structured log output follows the JSON Lines format (newline-delimited JSON) for ingestion by log processors like FluentBit, Loki, or Elasticsearch:\u003c/p\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Each log entry is a single JSON object terminated by \\n\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"timestamp\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e1699027200000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"level\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Server started\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"service\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"api\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"pid\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e12345\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"timestamp\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e1699027201000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"level\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e40\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Database connection failed\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"error\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Connection timeout\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"service\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"api\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string-property property\"\u003e\"pid\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e12345\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"flush-guarantees\"\u003eFlush Guarantees\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#flush-guarantees\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eflush()\u003c/code\u003e method provides the following guarantees:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDrains buffers of all enabled channels within a bounded time (default 5s timeout)\u003c/li\u003e\n\u003cli\u003eNever throws - errors are logged to console as fallback\u003c/li\u003e\n\u003cli\u003eReturns when all pending entries are written or timeout is reached\u003c/li\u003e\n\u003cli\u003eSafe to call multiple times concurrently\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"critical-path-reliability\"\u003eCritical Path Reliability\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#critical-path-reliability\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Synchronous logging for ERROR/FATAL ensures immediate output\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003elogSyncCritical\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e line \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    t\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    lvl\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    msg\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    rid\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003econtext\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?.\u003c/span\u003erequestId\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eline\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Never throw from logging - best effort only\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Optional: Synchronous file write for critical errors\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// if (criticalFd) fs.writeSync(criticalFd, line);\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Safe JSON serialization with limits and circular protection\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_CTX\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e20_000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_MSG\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2_000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_STACK\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e50\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003esafeStringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evalue\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e maxLength \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_CTX\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e seen \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eWeakSet\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evalue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e val\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e val \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e'object'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e val \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eseen\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ehas\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eval\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e'[Circular]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        seen\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eval\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e val \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e val\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_MSG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e val\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eslice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eMAX_MSG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'...[truncated]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e val\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e maxLength \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eslice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e maxLength\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'...[truncated]'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e'[Unserializable]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Strip ANSI escape codes for non-TTY output\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003estripAnsi\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e text\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ereplace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token regex\"\u003e\u003cspan class=\"token regex-delimiter\"\u003e/\u003c/span\u003e\u003cspan class=\"token regex-source language-regex\"\u003e\\x1b\\[[0-9;]*m\u003c/span\u003e\u003cspan class=\"token regex-delimiter\"\u003e/\u003c/span\u003e\u003cspan class=\"token regex-flags\"\u003eg\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// PII redaction hook (optional per channel)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eRedactFn\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eRedactConfig\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRedactFn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eapplyRedaction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e redact\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRedactConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003eredact\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token known-class-name class-name\"\u003eArray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eisArray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eredact\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Field-based redaction\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e redactFields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eSet\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eredact\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e value\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \n      redactFields\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ehas\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token string\"\u003e'[REDACTED]'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e value\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Custom redaction function\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e redact\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Ensure JSON lines contain no ANSI codes\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eformatJsonLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogEntry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e redact\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eRedactConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e redacted \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eapplyRedaction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentry\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e redact\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e serialized \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003esafeStringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eredacted\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003estripAnsi\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserialized\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"graceful-shutdown\"\u003eGraceful Shutdown\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#graceful-shutdown\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSAFE_CLOSE_MS\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Comprehensive process termination hooks\u003c/span\u003e\nprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'beforeExit'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'SIGTERM'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003egracefulExit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'SIGINT'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003egracefulExit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e130\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'uncaughtException'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Sync-log minimal line to stderr first\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e line \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    t\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003enow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    lvl\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFATAL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    msg\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Uncaught exception - process terminating'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    err\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emessage\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003estderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eline\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// Then capture full error context\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n    logLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFATAL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Uncaught exception - process terminating'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    includeStackTrace\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003egracefulExit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'unhandledRejection'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereason\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecaptureError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereason \u003cspan class=\"token keyword module\"\u003eas\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n    logLevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eERROR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Unhandled promise rejection'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    includeStackTrace\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003esafeGetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003egracefulExit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e logger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003esafeGetLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elogger\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Race between proper close and timeout\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n        logger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresolve \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresolve\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSAFE_CLOSE_MS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Best effort - don't block exit\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003efinally\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eexit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecode\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"guard-against-recursive-logging\"\u003eGuard Against Recursive Logging\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#guard-against-recursive-logging\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Use AsyncLocalStorage to prevent recursive logging per async context\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e recursionGuard \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eAsyncLocalStorage\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLoggerImpl\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogger\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erecursionGuard\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Prevent infinite loops in error handling - use direct console\u003c/span\u003e\n      \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Recursive logging detected:'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \n    recursionGuard\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ewriteToChannels\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003etrace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003edebug\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003einfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eINFO\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003ewarn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eWARN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eERROR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003efatal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFATAL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ewriteToChannels\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elevel\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogLevel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e error\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Implementation that might trigger errors and recursive logging\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"understanding-error-recovery-strategies\"\u003eUnderstanding Error Recovery Strategies\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#understanding-error-recovery-strategies\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eError recovery strategies control \u003cstrong\u003ewhat happens after an error is logged\u003c/strong\u003e, not the logging itself:\u003c/p\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Example: Processing a batch of files\u003c/span\u003e\n\u003cspan class=\"token keyword control-flow\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e file \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e files\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithErrorHandling\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eprocessFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efile\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      capture\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n        message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eFailed to process \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003efile\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e operation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'file-processing'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e filename\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e file \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      recovery\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        strategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eCONTINUE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Keep processing other files\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// Don't let one bad file stop the whole batch\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Example: Critical database connection\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e db \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithErrorHandling\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003econnectToDatabase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    capture\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Database connection failed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      reportToMonitoring\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    recovery\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      strategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eRETRY\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      retryCount\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      retryDelay\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Keep trying - app can't work without DB\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Example: Optional feature that might fail\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e userPreferences \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithErrorHandling\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eloadUserPreferences\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euserId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    capture\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Failed to load user preferences'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      context\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e userId \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    recovery\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      strategy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eErrorRecoveryStrategy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFALLBACK\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      fallbackValue\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDEFAULT_PREFERENCES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// App works fine with defaults\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"questions-for-review\"\u003eQuestions for Review\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#questions-for-review\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eShould error recovery strategies be pluggable?\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"future-enhancements-v2\"\u003eFuture Enhancements (v2+)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#future-enhancements-v2\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eItems suggested in review but deferred for initial implementation:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003ePlugin Architecture\u003c/strong\u003e: \u003ccode\u003elogger.use(plugin)\u003c/code\u003e for extensible middleware\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCircuit Breaker\u003c/strong\u003e: Automatic monitoring channel fallback during outages  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eErrorClassifier Registry\u003c/strong\u003e: Pluggable error classification rules\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAdvanced Performance Tracking\u003c/strong\u003e: Built-in metrics collection and analysis\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLog Event Streaming\u003c/strong\u003e: Global event emitter for real-time log processing\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePluggable Formatters\u003c/strong\u003e: Custom format registration system\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAdvanced Context Features\u003c/strong\u003e: Structured event fields, correlation IDs\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLog Compression\u003c/strong\u003e: Automatic compression of rotated log files\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSource Location Capture\u003c/strong\u003e: Optional \u003ccode\u003efile\u003c/code\u003e, \u003ccode\u003eline\u003c/code\u003e, \u003ccode\u003ecol\u003c/code\u003e fields from stack traces in debug builds\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCustom Formatters\u003c/strong\u003e: \u003ccode\u003eregisterFormatter(name, fn)\u003c/code\u003e for pluggable output formats beyond json/pretty/compact\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThese features can be added incrementally based on usage patterns and requirements.\u003c/p\u003e\n\u003ch3 id=\"nice-to-have-before-v1\"\u003eNice-to-Have Before v1\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nice-to-have-before-v1\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMonitoring Timeouts\u003c/strong\u003e: Per-entry deadlines and token-bucket rate limiting for monitoring channels\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eEnhanced Error Context\u003c/strong\u003e: Automatic source location capture in development mode\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAdvanced Sampling\u003c/strong\u003e: Intelligent sampling based on error patterns and frequency\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"critical-review-summary\"\u003eCritical Review Summary\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#critical-review-summary\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eChatGPT's feedback addressed key architectural issues:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Async/sync API inconsistency\u003cbr\u003e\n✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Split error handling into capture + recovery concerns\u003cbr\u003e\n✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Added LogChannel interface for extensibility\u003cbr\u003e\n✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Added synchronous critical path for ERROR/FATAL\u003cbr\u003e\n✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Added AsyncLocalStorage for context propagation\u003cbr\u003e\n✅ \u003cstrong\u003eFixed\u003c/strong\u003e: Added singleton pattern with DI support\u003cbr\u003e\n✅ \u003cstrong\u003eAdded\u003c/strong\u003e: Error class factory to reduce boilerplate\u003cbr\u003e\n✅ \u003cstrong\u003eAdded\u003c/strong\u003e: Context immutability clarification\u003cbr\u003e\n✅ \u003cstrong\u003eAdded\u003c/strong\u003e: Production reliability safeguards  \u003c/p\u003e\n\u003cp\u003e📋 \u003cstrong\u003eDeferred\u003c/strong\u003e: Plugin architecture, circuit breakers, advanced features\u003c/p\u003e\n\u003cp\u003eThe specification now provides a solid foundation that can be extended incrementally.\u003c/p\u003e\n\u003chr\u003e\n\u003chr\u003e\n\u003ch2 id=\"packaging-and-runtime-requirements\"\u003ePackaging and Runtime Requirements\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#packaging-and-runtime-requirements\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"nodejs-support\"\u003eNode.js Support\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nodejs-support\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMinimum version\u003c/strong\u003e: Node.js \u003e=24 (requires \u003ccode\u003eAsyncLocalStorage\u003c/code\u003e and \u003ccode\u003efs.writev\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eModule format\u003c/strong\u003e: \u003cstrong\u003ePure ESM\u003c/strong\u003e only. All published JS is ES Modules. No CommonJS build.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePackage metadata\u003c/strong\u003e:\n\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"@semantic-flow/logging\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"module\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"main\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./dist/index.js\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"module\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./dist/index.js\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"types\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./dist/index.d.ts\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"exports\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\".\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"types\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./dist/index.d.ts\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"import\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./dist/index.js\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"./package.json\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./package.json\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"engines\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token property\"\u003e\"node\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u003e=18.17\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"typescript-configuration\"\u003eTypeScript Configuration\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#typescript-configuration\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCompile ESM-only types\u003c/strong\u003e:\n\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token comment\"\u003e// tsconfig.build.json\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"compilerOptions\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"module\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ES2022\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"target\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ES2022\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"moduleResolution\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"bundler\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"declaration\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"declarationMap\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"emitDeclarationOnly\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"outDir\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"dist\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"sourceMap\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"inlineSources\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"verbatimModuleSyntax\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"exactOptionalPropertyTypes\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"lib\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ES2022\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"include\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"src\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"runtime-esm-hygiene\"\u003eRuntime ESM Hygiene\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#runtime-esm-hygiene\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eNo \u003ccode\u003erequire()\u003c/code\u003e\u003c/strong\u003e: Use \u003ccode\u003eimport\u003c/code\u003e/\u003ccode\u003eimport()\u003c/code\u003e everywhere\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eReplace \u003ccode\u003e__dirname/__filename\u003c/code\u003e\u003c/strong\u003e:\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e fileURLToPath \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"node:url\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e dirname \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"node:path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e __filename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003efileURLToPath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emeta\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e __dirname \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003edirname\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__filename\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eJSON imports\u003c/strong\u003e:\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003eschema\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./schema.json\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"json\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLI entry point\u003c/strong\u003e:\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token hashbang comment\"\u003e#!/usr/bin/env node\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e run \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../dist/cli.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token function\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"consumer-requirements\"\u003eConsumer Requirements\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#consumer-requirements\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ePure ESM consumers\u003c/strong\u003e: Standard \u003ccode\u003eimport\u003c/code\u003e statements\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCommonJS consumers\u003c/strong\u003e: Must use dynamic \u003ccode\u003eimport('@semantic-flow/logging')\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTree-shaking\u003c/strong\u003e: Channels kept in separate files for optimal bundling\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"testing-vitest\"\u003eTesting (Vitest)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#testing-vitest\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// vitest.config.ts\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e defineConfig \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vitest/config'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token function\"\u003edefineConfig\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  test\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    environment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'node'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    isolate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"cicd-requirements\"\u003eCI/CD Requirements\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cicd-requirements\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eJSON Lines validation\u003c/strong\u003e: Lint commit examples to ensure valid JSONL with newline at end\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConsole hygiene\u003c/strong\u003e: Enforce no \u003ccode\u003econsole.log\u003c/code\u003e in src except inside \u003ccode\u003eConsoleChannel\u003c/code\u003e or emergency fallback\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eESM purity check\u003c/strong\u003e: Block accidental CJS fields in package.json or \u003ccode\u003e*.cjs\u003c/code\u003e files in dist/\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eType checking\u003c/strong\u003e: Ensure all examples compile without errors\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePerformance benchmarks\u003c/strong\u003e: Automated benchmarks comparing against previous versions\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"build-tool-configuration\"\u003eBuild Tool Configuration\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#build-tool-configuration\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eTypeScript Compiler (tsc)\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003etsc --project tsconfig.build.json\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003etsup\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003etsup src/index.ts --format esm --dts --sourcemap\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eRollup\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003einput\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'src/index.ts'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eoutput\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003efile\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'dist/index.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003eformat\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'esm'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003esourcemap\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eesbuild\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003eesbuild \u003cspan class=\"token operator\"\u003e--\u003c/span\u003ebundle src\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ets\u003c/span\u003e \u003cspan class=\"token operator\"\u003e--\u003c/span\u003eformat\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eesm \u003cspan class=\"token operator\"\u003e--\u003c/span\u003eoutfile\u003cspan class=\"token operator\"\u003e=\u003c/span\u003edist\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ejs\u003c/span\u003e \u003cspan class=\"token operator\"\u003e--\u003c/span\u003esourcemap\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"optional-runtime-guardrails\"\u003eOptional Runtime Guardrails\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#optional-runtime-guardrails\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token comment\"\u003e// Add once at package init to catch CJS usage\u003c/span\u003e\n\u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erequire\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'undefined'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ethrow\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eError\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'This package is ESM-only. Use import().'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"todo\"\u003eTODO\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#todo\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"phase-1-core-infrastructure--complete\"\u003ePhase 1: Core Infrastructure ✅ COMPLETE\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-1-core-infrastructure--complete\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e[x] Create the \u003ccode\u003e@semantic-flow/logging\u003c/code\u003e package structure (directories, \u003ccode\u003epackage.json\u003c/code\u003e, \u003ccode\u003etsconfig.json\u003c/code\u003e).\n[x] Implement type definitions and interfaces in \u003ccode\u003eshared/logging/src/core/types.ts\u003c/code\u003e.\n[x] Implement error types and factory in \u003ccode\u003eshared/logging/src/errors/types.ts\u003c/code\u003e and \u003ccode\u003eshared/logging/src/errors/factory.ts\u003c/code\u003e.\n[x] Implement the \u003ccode\u003eConsoleChannel\u003c/code\u003e and \u003ccode\u003eLogChannel\u003c/code\u003e interface.\n[x] Implement the core \u003ccode\u003eLogger\u003c/code\u003e interface and basic \u003ccode\u003eLoggerImpl\u003c/code\u003e.\n[x] Implement the configuration system.\n[x] Implement main exports and factory functions.\n[x] Implement unit tests for core functionality.\n[x] Developer documentation created in \u003ccode\u003edocumentation/dev.logging-and-error-handling.md\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"phase-1-enhancement-function-name-capture--complete\"\u003ePhase 1 Enhancement: Function Name Capture ✅ COMPLETE\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-1-enhancement-function-name-capture--complete\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e[x] Implement automatic function/method name capture in log context.\n[x] Add configuration option to enable/disable function name capture.\n[x] Update developer documentation with function name capture feature.\n[x] Add unit tests for function name capture.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eImplementation Details:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAdded \u003ccode\u003efunction?: string\u003c/code\u003e field to \u003ca href=\"/sflo/shared/logging/src/core/types.ts:22\"\u003e\u003ccode\u003eLogContext\u003c/code\u003e\u003c/a\u003e interface\u003c/li\u003e\n\u003cli\u003eAdded \u003ccode\u003ecaptureFunctionName: boolean\u003c/code\u003e to \u003ccode\u003eautoContext\u003c/code\u003e configuration (default: \u003ccode\u003eNODE_ENV !== 'production'\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eImplemented stack trace parsing in \u003ca href=\"/sflo/shared/logging/src/utils/stack-trace.ts:1\"\u003e\u003ccode\u003eshared/logging/src/utils/stack-trace.ts\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eIntegrated capture into \u003ca href=\"/sflo/shared/logging/src/core/logger.ts:137\"\u003e\u003ccode\u003eLoggerImpl.log()\u003c/code\u003e\u003c/a\u003e method\u003c/li\u003e\n\u003cli\u003eUpdated \u003ca href=\"/sflo/documentation/dev.logging-and-error-handling.md:1\"\u003e\u003ccode\u003edocumentation/dev.logging-and-error-handling.md\u003c/code\u003e\u003c/a\u003e with comprehensive documentation\u003c/li\u003e\n\u003cli\u003eAdded environment variable \u003ccode\u003eSF_LOG_AUTO_CONTEXT_CAPTURE_FUNCTION_NAME\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eAll 11 unit tests passing in \u003ca href=\"/sflo/shared/logging/src/__tests__/core.test.ts:1\"\u003e\u003ccode\u003eshared/logging/src/__tests__/core.test.ts\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003ePerformance Considerations:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFunction name capture is environment-aware (disabled in production by default)\u003c/li\u003e\n\u003cli\u003eUses stack trace parsing which has a measurable performance cost\u003c/li\u003e\n\u003cli\u003eCan be explicitly enabled/disabled via configuration\u003c/li\u003e\n\u003cli\u003eSkips correct number of stack frames to capture the actual calling function\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"phase-2-advanced-features-planned\"\u003ePhase 2: Advanced Features (Planned)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-2-advanced-features-planned\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e[ ] File channel with rotation\n[ ] Monitoring channel (Sentry)\n[ ] Unified error handling (capture + recovery)\n[ ] Performance tracking enhancements\n[ ] Integration tests\u003c/p\u003e\n\u003ch2 id=\"decision\"\u003eDecision\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#decision\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003emodern ESM only, targeting NodeJS \u003e=24\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"summary\"\u003eSummary\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#summary\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePhase 1: Core Infrastructure for the Shared Logging and Error Handling System (\u003ccode\u003e@semantic-flow/logging\u003c/code\u003e) is complete, following the specification in \u003ca href=\"/sflo/documentation/task.2025-11-04-shared-logging-and-errorhandling.md:1\"\u003e\u003ccode\u003edocumentation/task.2025-11-04-shared-logging-and-errorhandling.md\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"phase-1-accomplishments\"\u003ePhase 1 Accomplishments\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#phase-1-accomplishments\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003ePackage Setup:\u003c/strong\u003e Created the \u003ccode\u003eshared/logging/\u003c/code\u003e package structure, including \u003ccode\u003epackage.json\u003c/code\u003e and \u003ccode\u003etsconfig.json\u003c/code\u003e configured for Pure ESM and Node.js \u003e=18.17.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCore Types:\u003c/strong\u003e Implemented all core types and interfaces in \u003ca href=\"/sflo/shared/logging/src/core/types.ts:1\"\u003e\u003ccode\u003eshared/logging/src/core/types.ts\u003c/code\u003e\u003c/a\u003e, including \u003ccode\u003eLogLevel\u003c/code\u003e, \u003ccode\u003eLogEntry\u003c/code\u003e, \u003ccode\u003eLogContext\u003c/code\u003e, \u003ccode\u003eLogChannel\u003c/code\u003e, and \u003ccode\u003eLoggerConfig\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eError Handling:\u003c/strong\u003e Implemented the base \u003ca href=\"/sflo/shared/logging/src/errors/types.ts:4\"\u003e\u003ccode\u003eSemanticFlowError\u003c/code\u003e\u003c/a\u003e class and the \u003ccode\u003ecreateErrorType\u003c/code\u003e factory function in \u003ca href=\"/sflo/shared/logging/src/errors/types.ts:1\"\u003e\u003ccode\u003eshared/logging/src/errors/types.ts\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConfiguration:\u003c/strong\u003e Implemented the configuration schema, default values, and the \u003ccode\u003eConfigLoader\u003c/code\u003e class with deep merging and log level parsing in \u003ccode\u003eshared/logging/src/config/\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConsole Channel:\u003c/strong\u003e Implemented the synchronous \u003ca href=\"/sflo/shared/logging/src/channels/console.ts:9\"\u003e\u003ccode\u003eConsoleChannel\u003c/code\u003e\u003c/a\u003e and necessary formatting utilities (\u003ccode\u003esafeStringify\u003c/code\u003e, \u003ccode\u003estripAnsi\u003c/code\u003e, \u003ccode\u003eformatCritical\u003c/code\u003e) in \u003ca href=\"/sflo/shared/logging/src/channels/console.ts:1\"\u003e\u003ccode\u003eshared/logging/src/channels/console.ts\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"/sflo/shared/logging/src/core/formatters.ts:1\"\u003e\u003ccode\u003eshared/logging/src/core/formatters.ts\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCore Logger:\u003c/strong\u003e Implemented the \u003ca href=\"/sflo/shared/logging/src/core/logger.ts:23\"\u003e\u003ccode\u003eLogger\u003c/code\u003e\u003c/a\u003e interface and \u003ca href=\"/sflo/shared/logging/src/core/logger.ts:91\"\u003e\u003ccode\u003eLoggerImpl\u003c/code\u003e\u003c/a\u003e class, including auto-context generation, channel dispatch, and basic timer functionality.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContext Management:\u003c/strong\u003e Implemented the \u003ca href=\"/sflo/shared/logging/src/core/context.ts:12\"\u003e\u003ccode\u003eContextManager\u003c/code\u003e\u003c/a\u003e using \u003ccode\u003eAsyncLocalStorage\u003c/code\u003e for context propagation.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFactory Functions:\u003c/strong\u003e Implemented the singleton pattern (\u003ccode\u003einitLogger\u003c/code\u003e, \u003ccode\u003egetLogger\u003c/code\u003e) and specialized factory functions (\u003ccode\u003ecreateCliLogger\u003c/code\u003e, \u003ccode\u003ecreateServiceLogger\u003c/code\u003e) in \u003ca href=\"/sflo/shared/logging/src/core/logger.ts:1\"\u003e\u003ccode\u003eshared/logging/src/core/logger.ts\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExports:\u003c/strong\u003e Consolidated all public exports in \u003ca href=\"/sflo/shared/logging/src/index.ts:1\"\u003e\u003ccode\u003eshared/logging/src/index.ts\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eUnit Tests:\u003c/strong\u003e Implemented core unit tests in \u003ca href=\"/sflo/shared/logging/src/__tests__/core.test.ts:1\"\u003e\u003ccode\u003eshared/logging/src/__tests__/core.test.ts\u003c/code\u003e\u003c/a\u003e using a \u003ccode\u003eMockLogger\u003c/code\u003e utility, covering singleton behavior, context propagation, and error handling.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host\"\u003efunction/method name capture, addressed all CodeRabbit suggestions, and integrated the logging system into sflo-host\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#functionmethod-name-capture-addressed-all-coderabbit-suggestions-and-integrated-the-logging-system-into-sflo-host\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"1-function-name-capture-feature-\"\u003e1. Function Name Capture Feature ✅\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#1-function-name-capture-feature-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAdded \u003ca href=\"/sflo/shared/logging/src/core/types.ts:22\"\u003e\u003ccode\u003efunction?: string\u003c/code\u003e\u003c/a\u003e field to \u003ccode\u003eLogContext\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eImplemented stack trace parsing in \u003ca href=\"/sflo/shared/logging/src/utils/stack-trace.ts:1\"\u003e\u003ccode\u003eshared/logging/src/utils/stack-trace.ts\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eIntegrated into \u003ca href=\"/sflo/shared/logging/src/core/logger.ts:139\"\u003e\u003ccode\u003eLoggerImpl.log()\u003c/code\u003e\u003c/a\u003e with environment-aware defaults\u003c/li\u003e\n\u003cli\u003eComprehensive documentation in \u003ca href=\"/sflo/documentation/dev.logging-and-error-handling.md:108\"\u003e\u003ccode\u003edocumentation/dev.logging-and-error-handling.md\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-coderabbit-critical-fixes-\"\u003e2. CodeRabbit Critical Fixes ✅\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#2-coderabbit-critical-fixes-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eChannel Sharing\u003c/strong\u003e - Fixed resource leak where child loggers created duplicate channels\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAsync Logger Cleanup\u003c/strong\u003e - Made \u003ccode\u003einitLogger()\u003c/code\u003e async to properly await channel closure\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTest Reset Cleanup\u003c/strong\u003e - Made \u003ccode\u003e__resetLoggerForTests()\u003c/code\u003e async with proper channel cleanup\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLI Tool Name Safety\u003c/strong\u003e - Added try-catch for \u003ccode\u003efileURLToPath()\u003c/code\u003e edge cases\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTest Config Isolation\u003c/strong\u003e - Fixed \u003ccode\u003ecreateTestConfig()\u003c/code\u003e to return deep copy\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRace Condition Fix\u003c/strong\u003e - Fixed \u003ccode\u003ewaitForLogs()\u003c/code\u003e with proper timeout cleanup\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRedaction Logic Fix\u003c/strong\u003e - Fixed critical bug using \u003ccode\u003eJSON.stringify\u003c/code\u003e replacer correctly\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDoS Protection\u003c/strong\u003e - Added \u003ccode\u003eMAX_CTX * 2\u003c/code\u003e upper bound for log entries\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSchema Validation\u003c/strong\u003e - Added minimum constraints for \u003ccode\u003ebufferSize\u003c/code\u003e/\u003ccode\u003eflushInterval\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eComment Clarity\u003c/strong\u003e - Fixed misleading async buffering comment\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCode Cleanup\u003c/strong\u003e - Removed unused \u003ccode\u003elogs\u003c/code\u003e property from \u003ccode\u003eMockLogger\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"3-sflo-host-integration-\"\u003e3. SFLO Host Integration ✅\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#3-sflo-host-integration-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eUpdated Files:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/sflo/sflo-host/package.json:15\"\u003e\u003ccode\u003esflo-host/package.json\u003c/code\u003e\u003c/a\u003e - Added \u003ccode\u003e@semantic-flow/logging\u003c/code\u003e dependency\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/sflo/sflo-host/src/index.ts:1\"\u003e\u003ccode\u003esflo-host/src/index.ts\u003c/code\u003e\u003c/a\u003e - Integrated logging system:\n\u003cul\u003e\n\u003cli\u003eReplaced Fastify's built-in logger with \u003ccode\u003e@semantic-flow/logging\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eAdded component-scoped logger using \u003ccode\u003egetComponentLogger(import.meta.url)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eInitialized logger at startup with environment-aware configuration\u003c/li\u003e\n\u003cli\u003eAdded graceful shutdown handlers for SIGTERM/SIGINT\u003c/li\u003e\n\u003cli\u003eReplaced all \u003ccode\u003eapp.log\u003c/code\u003e calls with structured logging using \u003ccode\u003emetadata\u003c/code\u003e field\u003c/li\u003e\n\u003cli\u003eAdded proper error handling with \u003ccode\u003elogger.fatal()\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eIntegration Features:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEnvironment-aware log levels (DEBUG in dev, INFO in prod)\u003c/li\u003e\n\u003cli\u003ePretty formatting in development, JSON in production\u003c/li\u003e\n\u003cli\u003eComponent name automatically captured as 'index'\u003c/li\u003e\n\u003cli\u003eGraceful shutdown with log flushing\u003c/li\u003e\n\u003cli\u003eStructured logging with metadata for all application events\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"test-results-\"\u003eTest Results ✅\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#test-results-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll 11 unit tests passing in \u003ca href=\"/sflo/shared/logging/src/__tests__/core.test.ts:1\"\u003e\u003ccode\u003eshared/logging/src/__tests__/core.test.ts\u003c/code\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"typescript-compilation-\"\u003eTypeScript Compilation ✅\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#typescript-compilation-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eLogging package builds successfully\u003c/li\u003e\n\u003cli\u003eSFLO Host compiles without errors\u003c/li\u003e\n\u003cli\u003eAll workspace dependencies linked correctly\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe \u003ccode\u003e@semantic-flow/logging\u003c/code\u003e package is now production-ready and fully integrated into the SFLO Host application!\u003c/p\u003e","noteIndex":{"id":"voy7zrf0f6bs86m02uadhaf","title":"Semantic Flow Documentation","desc":"","updated":1756155165637,"created":1755709990079,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"documentation","selfContained":false,"name":"sflo"},"contentHash":"98cbbdb73a40d62308166fed9c2f594f","links":[{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"now","position":{"start":{"line":4,"column":1,"offset":107},"end":{"line":4,"column":8,"offset":114},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"now"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"todo","position":{"start":{"line":4,"column":11,"offset":117},"end":{"line":4,"column":19,"offset":125},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"todo"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"principle","position":{"start":{"line":4,"column":22,"offset":128},"end":{"line":4,"column":35,"offset":141},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"principle"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"dev.contributor.djradon.dev-log","position":{"start":{"line":4,"column":38,"offset":144},"end":{"line":4,"column":73,"offset":179},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"dev.contributor.djradon.dev-log"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"concept.single-mesh-repo","position":{"start":{"line":10,"column":1,"offset":498},"end":{"line":10,"column":29,"offset":526},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"concept.single-mesh-repo"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"concept.mesh","position":{"start":{"line":10,"column":47,"offset":544},"end":{"line":10,"column":63,"offset":560},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"concept.mesh"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"concept.semantic-flow-site","position":{"start":{"line":10,"column":112,"offset":609},"end":{"line":10,"column":142,"offset":639},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"concept.semantic-flow-site"}},{"type":"wiki","from":{"fname":"root","id":"voy7zrf0f6bs86m02uadhaf","vaultName":"sflo"},"value":"feature","position":{"start":{"line":23,"column":7,"offset":1053},"end":{"line":23,"column":18,"offset":1064},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"feature"}}],"anchors":{"what-is-semantic-flow":{"type":"header","text":"What Is Semantic Flow?","value":"what-is-semantic-flow","line":12,"column":0,"depth":2},"benefits":{"type":"header","text":"Benefits","value":"benefits","line":18,"column":0,"depth":2},"features":{"type":"header","text":"Features","value":"features","line":25,"column":0,"depth":2}},"children":["completed-tasks","p0vd6xnshcxw14ztkglxyxn","qa6hqxy4tknnmutvq13onaq","sfgrcjcttxz7b3qov7efg3f","facets","faq000","ggle3sz2jv3vf53t9qplrzo","mesh-file","mesh-folder","guides","mesh-resource","yxn5rsqsv2gq4s6wbnxsjsj","l9g8eki3dtir51o4jagac5a","28q7fh05bs691llgv7htxnw","products","tkw34hrqxficesa0y2r62s0","tasks","xqjr13fyons9goxv8rjrskj","use-cases","8wh7p4aps8humop7vqymk3n"],"parent":null,"data":{},"body":"\n**Dereferenceable, versioned semantic meshes** will be the foundation for a new era of knowledge graphs.\n\n[[now]] | [[todo]] | [[principle]] | [[dev.contributor.djradon.dev-log]]\n\n## What Is Semantic Flow?\n\n**Semantic Flow** is a framework for managing and publishing resource identifiers, knowledge graphs and other semantic data by leveraging GitHub, Gitlab, and other free static hosting services. It enables a **dereferenceable Semantic Web** where every HTTP IRI returns meaningful content.\n\n[[concept.single-mesh-repo]] provide storage, [[concept.mesh]] provide resource management and publishing, and [[concept.semantic-flow-site]] support data discovery and explainability.\n\n## Benefits\n\n- own your own self-describing data and data schemas\n- complete version history when you want it\n- reliable persistence\n- truly FAIR (Findable, Accessible, Interoperable, and Reusable)\n\n## Features\n\n- seamlessly integrate other data sources anywhere in your mesh\n- generate and customize mini-sites or single-page applications for nodes in your mesh\n- see [[feature]] for a list of planned features\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"none","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"selection","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"documentation","selfContained":false,"name":"sflo"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Semantic Flow Docs","description":"A dendron-based wiki for sflo"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://semantic-flow.github.io/sflo","assetsPrefix":"/sflo","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"3hejrrsh4j7i5p2l7rk38n6"},"buildId":"stable-build-id","assetPrefix":"/sflo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>