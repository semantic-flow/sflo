@base <https://semantic-flow.github.io/ontology/semantic-flow/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix schema: <https://schema.org/> .
@prefix vann: <http://purl.org/vocab/vann/> .
@prefix sflo: <https://semantic-flow.github.io/ontology/semantic-flow/> .

<> a owl:Ontology ;
    dcterms:title "Semantic Flow Ontology" ;
    dcterms:description "The Semantic Flow ontology defines the classes and properties used for defining and describing semantic meshes." ;
    dcterms:creator <https://djradon.github.io/ns/djradon> ;
    owl:versionInfo "1" ;
    owl:versionIRI <https://semantic-flow.github.io/ontology/semantic-flow/_dataset-flow/v1/sflo_v1.ttl> ;
    vann:preferredNamespacePrefix "sflo" ;
    vann:preferredNamespaceUri "https://semantic-flow.github.io/ontology/semantic-flow/" .

#################################################################
#    Resource Classes 
#################################################################

# Base resource for all terms in this ontology
sflo:Resource a rdfs:Class ;
    rdfs:label "Resource" ;
    rdfs:comment "Abstract base class for all Semantic Flow resources. Provides fundamental identification and documentation affordances." .

# File-based resources (e.g., README.md, index.html, .trig distributions)
sflo:FileResource a rdfs:Class ;
    rdfs:subClassOf sflo:Resource ;
    rdfs:label "File Resource" ;
    rdfs:comment "A resource that locates and corresponds directly to a file." .

# Naming resources (folder-like, slash-terminated IRIs)
sflo:NamingResource a rdfs:Class ;
    rdfs:subClassOf sflo:Resource ;
    rdfs:label "Naming Resource" ;
    rdfs:comment "A resource that establishes a name, optionally denoting a non-file thing. Naming resources' IRIs end with a slash and may or may not have a referent." .

#################################################################
#    DocumentationResource Classes and Properties
#################################################################

# Classes 
sflo:DocumentationResource a rdfs:Class ;
    rdfs:subClassOf sflo:FileResource ;
    rdfs:label "Documentation Resource" ;
    rdfs:comment "Documentation files that provide human-readable information about resources. Abstract." .

sflo:ResourcePage a rdfs:Class ;
    rdfs:subClassOf sflo:DocumentationResource ;
    rdfs:label "Resource Page" ;
    rdfs:comment "Human-readable index.html pages that provide dereferenceability for NamingResources." .

sflo:Changelog a rdfs:Class ;
    rdfs:subClassOf sflo:DocumentationResource ;
    rdfs:label "Changelog" ;
    rdfs:comment "Changelog files that document version history and changes for resources." .

sflo:Readme a rdfs:Class ;
    rdfs:subClassOf sflo:DocumentationResource ;
    rdfs:label "Readme" ;
    rdfs:comment "Readme files that provide introductory documentation and usage information." .


# Properties
sflo:hasReadme a owl:ObjectProperty ;
    schema:domainIncludes sflo:NamingResource ;
    schema:rangeIncludes sflo:Readme ;
    rdfs:label "has readme" ;
    rdfs:comment "Associates a namespace resource with its README documentation file." .

sflo:hasChangelog a owl:ObjectProperty ;
    schema:domainIncludes sflo:NamingResource ;
    schema:rangeIncludes sflo:Changelog ;
    rdfs:label "has changelog" ;
    rdfs:comment "Associates a namespace resource with its changelog documentation file." .



#################################################################
#    Mesh Structure Classes
#################################################################

# Mesh Node (naming resource)
sflo:MeshNode a rdfs:Class ;
    rdfs:subClassOf sflo:NamingResource ;
    rdfs:label "Mesh Node" ;
    rdfs:comment "Structural units that organize and contain other resources. Nodes form the structure of the mesh." .

#################################################################
#    Node Component Classes
#################################################################

sflo:Component a rdfs:Class ;
    rdfs:subClassOf sflo:Resource ;
    rdfs:label "Component" ;
    rdfs:comment "Terminal resources that provide specific mesh functionality and support nodes." .

sflo:Handle a rdfs:Class ;
    rdfs:label "Handle" ;
    rdfs:comment "Conceptual handle that refers to a node 'as a node' (as opposed to the thing/concept referred to by the parent node). This is the abstract handle concept." .

sflo:HandleAsComponent a rdfs:Class ;
    rdfs:subClassOf sflo:Component, sflo:NamingResource ;
    rdfs:label "Handle As Component" ;
    rdfs:comment "A handle considered as a mesh component in its own right, addressable via IRI and subject to mesh operations." .

#################################################################
#    Node Type Classes
#################################################################

sflo:BareNode a rdfs:Class ;
    rdfs:subClassOf sflo:MeshNode ;
    rdfs:label "Namespace" ;
    rdfs:comment "Bare nodes - containers for organizing other mesh nodes. Node identifiers refer to the nodes themselves as organizational units." .

sflo:ReferenceNode a rdfs:Class ;
    rdfs:subClassOf sflo:MeshNode ;
    rdfs:label "Reference" ;
    rdfs:comment "Nodes that refer to some external 'thing' or concept other than themselves." .

sflo:DataNode a rdfs:Class ;
    rdfs:subClassOf sflo:MeshNode ;
    rdfs:label "Data" ;
    rdfs:comment "Nodes that contain and refer to 'payload data' via dataset flows." .

#################################################################
#    Flow Class
#################################################################

sflo:Flow a rdfs:Class ;
    rdfs:subClassOf dcat:DatasetSeries, sflo:Resource ;
    rdfs:label "Flow" ;
    rdfs:comment "Abstract evolvable datasets for node metadata, reference data, payload data, and configuration. Flows are DatasetSeries that are realized through flow snapshots representing specific states or versions." .

#################################################################
#    Object Properties 
#################################################################

sflo:hasElement a owl:ObjectProperty ;
    schema:domainIncludes sflo:MeshNode ;
    schema:rangeIncludes sflo:Component ;
    rdfs:label "has element" ;
    rdfs:comment "Associates nodes with their supporting components." .

sflo:isHandleFor a owl:ObjectProperty ;
    schema:domainIncludes sflo:HandleAsComponent ;
    schema:rangeIncludes sflo:MeshNode ;
    rdfs:label "is handle for" ;
    rdfs:comment "Indicates that this handle component provides identification and routing for a specific node." .

sflo:hasHandle a owl:ObjectProperty ;
    schema:domainIncludes sflo:MeshNode ;
    schema:rangeIncludes sflo:HandleAsComponent ;
    rdfs:label "has handle" ;
    rdfs:comment "Associates a mesh node with its persistent handle component." .

sflo:hasFlow a owl:ObjectProperty ;
    schema:domainIncludes sflo:MeshNode ;
    schema:rangeIncludes sflo:Flow ;
    rdfs:label "has flow" ;
    rdfs:comment "Links mesh nodes to their flows (metadata, reference, data, config)." .

#################################################################
#    Data Properties 
#################################################################

sflo:hasSlug a owl:DatatypeProperty ;
    schema:domainIncludes sflo:MeshNode ;
    schema:rangeIncludes xsd:string ;
    rdfs:label "has slug" ;
    rdfs:comment "A concise, human-readable, kebab-case identifier for a node, suitable for use in filenames and URLs." .

#################################################################
#    Disjointness Axioms 
#################################################################

# File vs Naming resources are disjoint
[ a owl:AllDisjointClasses ;
  owl:members ( sflo:FileResource sflo:NamingResource )
] .

# Node types are disjoint
[ a owl:AllDisjointClasses ;
  owl:members ( sflo:BareNode sflo:ReferenceNode sflo:DataNode )
] .

# Component types are disjoint  
[ a owl:AllDisjointClasses ;
  owl:members ( sflo:HandleAsComponent sflo:DocumentationResource )
] .

#################################################################
#    SHACL Constraints 
#################################################################


### NamingResource: IRI must end with a slash (/)
sflo:NamingResourceShape a sh:NodeShape ;
    sh:targetClass sflo:NamingResource ;
    sh:nodeKind sh:IRI ;
    sh:sparql [
        sh:message "NamingResource IRI must end with a slash (/)." ;
        sh:select """
            SELECT ?this WHERE {
                FILTER ( !STRENDS(STR(?this), "/") )
            }
        """ ;
    ] .

### FileResource: IRI must NOT end with a slash (/)
sflo:FileResourceShape a sh:NodeShape ;
    sh:targetClass sflo:FileResource ;
    sh:nodeKind sh:IRI ;
    sh:sparql [
        sh:message "FileResource IRI must not end with a slash (/)." ;
        sh:select """
            SELECT ?this WHERE {
                FILTER ( STRENDS(STR(?this), "/") )
            }
        """ ;
    ] .
    

### Every MeshNode must have exactly one HandleAsComponent
sflo:MeshNodeShape a sh:NodeShape ;
    sh:targetClass sflo:MeshNode ;
    sh:property [
        sh:path sflo:hasHandle ;
        sh:class sflo:HandleAsComponent ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Every MeshNode must have exactly one HandleAsComponent"
    ] ;
    sh:property [
        sh:path sflo:hasSlug ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:pattern "^[a-z0-9]+(-[a-z0-9]+)*$" ;
        sh:message "Every MeshNode must have exactly one slug matching kebab-case pattern (lowercase letters, numbers, hyphens)"
    ] .

### HandleAsComponent must be handle for exactly one node
sflo:HandleAsComponentShape a sh:NodeShape ;
    sh:targetClass sflo:HandleAsComponent ;
    sh:property [
        sh:path sflo:isHandleFor ;
        sh:class sflo:MeshNode ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Every HandleAsComponent must be handle for exactly one MeshNode"
    ] .

#################################################################
#    TODO (Next Slices)
#################################################################
# Slice 4 (Flow / Temporal Model):
# - Classes: sflo:Snapshot, sflo:VersionSnapshot, sflo:ConfigFlow, sflo:MetadataFlow,
#            sflo:ReferenceFlow, sflo:DatasetFlow
# - Properties: sflo:hasSnapshot, sflo:hasVersionSnapshot, sflo:hasPreviousSnapshot,
#               sflo:versioningState, sflo:hasConfig, sflo:hasMetadata,
#               sflo:hasReference, sflo:hasData
# - SHACL: Distribution ↔ Snapshot ↔ Flow constraints; versioning state enumeration
